{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# IBM: DATA SCIENCE CAPSTONE PROJECT - BATTLE OF THE NEIGHBOURHOODS\n",
    "\n",
    "# Introduction/Business Problem\n",
    "### This study will focus on helping the investors of a major condominium real-estate developer who are planning on expanding their enterprise to Toronto. The group, however, has no prior knowledge of Toronto's neighbourhoods, and demographic patterns. Our team has been approached by the investors with the task of finding the optimal location in Toronto where they should focus on constructing their new luxury-condominium project.\n",
    "\n",
    "The investors will be looking for areas in Toronto that meet the following specifications:\n",
    "    - The neighbourhood must be within a certain range of total population\n",
    "    - Additionally, an above average population of 25â€“54 year-old working professionals must be met\n",
    "    - The neighbourhood should be populated with an above average number of individuals with higher education\n",
    "    - An above average avg. household income \n",
    "\n",
    "### Steps:\n",
    "### 1 - Cleaning & Preprocessing\n",
    "    Cleaning (completed in R)\n",
    "    Data-Types\n",
    "    Check for duplicates/NAN\n",
    "    Feature Selection\n",
    "### 2 - Data Exploration & Normalization \n",
    "    Check distributions\n",
    "    Give neighbourhoods a standardized score\n",
    "### 3 - KMeans Clustering\n",
    "    Select top-20 neighbourhood to run KMeans    \n",
    "### 4 - Create Toronto Map\n",
    "    Use Folium package\n",
    "    Apply clusters are markers on final map"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 139,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Libraries imported.\n"
     ]
    }
   ],
   "source": [
    "#importing libraries\n",
    "\n",
    "import pandas as pd\n",
    "import numpy as np\n",
    "import requests\n",
    "\n",
    "from sklearn import preprocessing\n",
    "\n",
    "from sklearn.cluster import KMeans\n",
    "\n",
    "import matplotlib.cm as cm\n",
    "import matplotlib.colors as colors\n",
    "!conda install -c conda-forge folium=0.5.0 --yes\n",
    "import folium\n",
    "\n",
    "print('Libraries imported.')\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# 1 - Cleaning & Preprocessing \n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Import the Toronto neighbourhood census data"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 187,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Unnamed: 0</th>\n",
       "      <th>Population 2016</th>\n",
       "      <th>Population 2011</th>\n",
       "      <th>Working Age (25-54)</th>\n",
       "      <th>Total Income</th>\n",
       "      <th>Avg. Total Income</th>\n",
       "      <th>Total Secondary Education</th>\n",
       "      <th>Total Employment Rate</th>\n",
       "      <th>Emploment Rate (Male)</th>\n",
       "      <th>Employement Rate (Female)</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>0</td>\n",
       "      <td>City.of.Toronto</td>\n",
       "      <td>2,731,571</td>\n",
       "      <td>2,615,060</td>\n",
       "      <td>1,229,555</td>\n",
       "      <td>2,294,785</td>\n",
       "      <td>52,268</td>\n",
       "      <td>2294785</td>\n",
       "      <td>59.3</td>\n",
       "      <td>63.8</td>\n",
       "      <td>55.2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>Agincourt.North</td>\n",
       "      <td>29,113</td>\n",
       "      <td>30,279</td>\n",
       "      <td>11,305</td>\n",
       "      <td>25,005</td>\n",
       "      <td>30,414</td>\n",
       "      <td>25000</td>\n",
       "      <td>50.0</td>\n",
       "      <td>54.5</td>\n",
       "      <td>46.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>Agincourt.South.Malvern.West</td>\n",
       "      <td>23,757</td>\n",
       "      <td>21,988</td>\n",
       "      <td>9,965</td>\n",
       "      <td>20,400</td>\n",
       "      <td>31,825</td>\n",
       "      <td>20400</td>\n",
       "      <td>53.2</td>\n",
       "      <td>58.2</td>\n",
       "      <td>48.7</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>Alderwood</td>\n",
       "      <td>12,054</td>\n",
       "      <td>11,904</td>\n",
       "      <td>5,220</td>\n",
       "      <td>10,265</td>\n",
       "      <td>47,709</td>\n",
       "      <td>10265</td>\n",
       "      <td>62.4</td>\n",
       "      <td>67.1</td>\n",
       "      <td>57.9</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>Annex</td>\n",
       "      <td>30,526</td>\n",
       "      <td>29,177</td>\n",
       "      <td>15,040</td>\n",
       "      <td>26,295</td>\n",
       "      <td>112,766</td>\n",
       "      <td>26290</td>\n",
       "      <td>65.8</td>\n",
       "      <td>68.9</td>\n",
       "      <td>63.1</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                     Unnamed: 0 Population 2016 Population 2011  \\\n",
       "0               City.of.Toronto       2,731,571       2,615,060   \n",
       "1               Agincourt.North          29,113          30,279   \n",
       "2  Agincourt.South.Malvern.West          23,757          21,988   \n",
       "3                     Alderwood          12,054          11,904   \n",
       "4                         Annex          30,526          29,177   \n",
       "\n",
       "  Working Age (25-54) Total Income Avg. Total Income  \\\n",
       "0           1,229,555    2,294,785            52,268   \n",
       "1              11,305       25,005            30,414   \n",
       "2               9,965       20,400            31,825   \n",
       "3               5,220       10,265            47,709   \n",
       "4              15,040       26,295           112,766   \n",
       "\n",
       "   Total Secondary Education  Total Employment Rate  Emploment Rate (Male)  \\\n",
       "0                    2294785                   59.3                   63.8   \n",
       "1                      25000                   50.0                   54.5   \n",
       "2                      20400                   53.2                   58.2   \n",
       "3                      10265                   62.4                   67.1   \n",
       "4                      26290                   65.8                   68.9   \n",
       "\n",
       "   Employement Rate (Female)  \n",
       "0                       55.2  \n",
       "1                       46.0  \n",
       "2                       48.7  \n",
       "3                       57.9  \n",
       "4                       63.1  "
      ]
     },
     "execution_count": 187,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#import .csv file\n",
    "neighbourhood_df = pd.read_csv(\"neighbourhood_profiles.csv\")\n",
    "neighbourhood_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 188,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Unnamed: 0</th>\n",
       "      <th>Population 2016</th>\n",
       "      <th>Working Age (25-54)</th>\n",
       "      <th>Avg. Total Income</th>\n",
       "      <th>Total Secondary Education</th>\n",
       "      <th>Total Employment Rate</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>Agincourt.North</td>\n",
       "      <td>29,113</td>\n",
       "      <td>11,305</td>\n",
       "      <td>30,414</td>\n",
       "      <td>25000</td>\n",
       "      <td>50.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>Agincourt.South.Malvern.West</td>\n",
       "      <td>23,757</td>\n",
       "      <td>9,965</td>\n",
       "      <td>31,825</td>\n",
       "      <td>20400</td>\n",
       "      <td>53.2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>Alderwood</td>\n",
       "      <td>12,054</td>\n",
       "      <td>5,220</td>\n",
       "      <td>47,709</td>\n",
       "      <td>10265</td>\n",
       "      <td>62.4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>Annex</td>\n",
       "      <td>30,526</td>\n",
       "      <td>15,040</td>\n",
       "      <td>112,766</td>\n",
       "      <td>26290</td>\n",
       "      <td>65.8</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>5</td>\n",
       "      <td>Banbury.Don.Mills</td>\n",
       "      <td>27,695</td>\n",
       "      <td>10,810</td>\n",
       "      <td>67,757</td>\n",
       "      <td>23390</td>\n",
       "      <td>55.6</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                     Unnamed: 0 Population 2016 Working Age (25-54)  \\\n",
       "1               Agincourt.North          29,113              11,305   \n",
       "2  Agincourt.South.Malvern.West          23,757               9,965   \n",
       "3                     Alderwood          12,054               5,220   \n",
       "4                         Annex          30,526              15,040   \n",
       "5             Banbury.Don.Mills          27,695              10,810   \n",
       "\n",
       "  Avg. Total Income  Total Secondary Education  Total Employment Rate  \n",
       "1            30,414                      25000                   50.0  \n",
       "2            31,825                      20400                   53.2  \n",
       "3            47,709                      10265                   62.4  \n",
       "4           112,766                      26290                   65.8  \n",
       "5            67,757                      23390                   55.6  "
      ]
     },
     "execution_count": 188,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#drop unnecessary first row & columns\n",
    "neighbourhood_df.drop(neighbourhood_df.index[0],inplace=True)\n",
    "neighbourhood_df.drop(['Population 2011',\n",
    "                           'Total Income',\n",
    "                           'Emploment Rate (Male)',\n",
    "                           'Employement Rate (Female)'], axis=1, inplace=True)\n",
    "neighbourhood_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 189,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Neighbourhood</th>\n",
       "      <th>Population 2016</th>\n",
       "      <th>Working Age (25-54)</th>\n",
       "      <th>Avg. Total Income</th>\n",
       "      <th>Total Higher Education</th>\n",
       "      <th>Total Employment Rate</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>0</td>\n",
       "      <td>Agincourt.North</td>\n",
       "      <td>29,113</td>\n",
       "      <td>11,305</td>\n",
       "      <td>30,414</td>\n",
       "      <td>25000</td>\n",
       "      <td>50.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>Agincourt.South.Malvern.West</td>\n",
       "      <td>23,757</td>\n",
       "      <td>9,965</td>\n",
       "      <td>31,825</td>\n",
       "      <td>20400</td>\n",
       "      <td>53.2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>Alderwood</td>\n",
       "      <td>12,054</td>\n",
       "      <td>5,220</td>\n",
       "      <td>47,709</td>\n",
       "      <td>10265</td>\n",
       "      <td>62.4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>Annex</td>\n",
       "      <td>30,526</td>\n",
       "      <td>15,040</td>\n",
       "      <td>112,766</td>\n",
       "      <td>26290</td>\n",
       "      <td>65.8</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>Banbury.Don.Mills</td>\n",
       "      <td>27,695</td>\n",
       "      <td>10,810</td>\n",
       "      <td>67,757</td>\n",
       "      <td>23390</td>\n",
       "      <td>55.6</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                  Neighbourhood Population 2016 Working Age (25-54)  \\\n",
       "0               Agincourt.North          29,113              11,305   \n",
       "1  Agincourt.South.Malvern.West          23,757               9,965   \n",
       "2                     Alderwood          12,054               5,220   \n",
       "3                         Annex          30,526              15,040   \n",
       "4             Banbury.Don.Mills          27,695              10,810   \n",
       "\n",
       "  Avg. Total Income  Total Higher Education  Total Employment Rate  \n",
       "0            30,414                   25000                   50.0  \n",
       "1            31,825                   20400                   53.2  \n",
       "2            47,709                   10265                   62.4  \n",
       "3           112,766                   26290                   65.8  \n",
       "4            67,757                   23390                   55.6  "
      ]
     },
     "execution_count": 189,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#reset index & rename\n",
    "neighbourhood_df.reset_index(drop=True, inplace=True)\n",
    "neighbourhood_df.rename({'Unnamed: 0': 'Neighbourhood', \n",
    "                         'Total Secondary Education': 'Total Higher Education'}, axis='columns', inplace=True)\n",
    "\n",
    "neighbourhood_df.head()\n",
    "\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Import Toronto neighbourhood coordinate data"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 190,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>AREA_NAME</th>\n",
       "      <th>LONGITUDE</th>\n",
       "      <th>LATITUDE</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>0</td>\n",
       "      <td>Wychwood (94)</td>\n",
       "      <td>-79.425515</td>\n",
       "      <td>43.676919</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>Yonge-Eglinton (100)</td>\n",
       "      <td>-79.403590</td>\n",
       "      <td>43.704689</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>Yonge-St.Clair (97)</td>\n",
       "      <td>-79.397871</td>\n",
       "      <td>43.687859</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>York University Heights (27)</td>\n",
       "      <td>-79.488883</td>\n",
       "      <td>43.765736</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>Yorkdale-Glen Park (31)</td>\n",
       "      <td>-79.457108</td>\n",
       "      <td>43.714672</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                      AREA_NAME  LONGITUDE   LATITUDE\n",
       "0                 Wychwood (94) -79.425515  43.676919\n",
       "1          Yonge-Eglinton (100) -79.403590  43.704689\n",
       "2           Yonge-St.Clair (97) -79.397871  43.687859\n",
       "3  York University Heights (27) -79.488883  43.765736\n",
       "4       Yorkdale-Glen Park (31) -79.457108  43.714672"
      ]
     },
     "execution_count": 190,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#drop unnecessary columns\n",
    "coord_df = pd.read_csv('neighbourhood_coordinates.csv')\n",
    "coord_df.drop(['_id',\n",
    "               'AREA_ID',\n",
    "               'AREA_ATTR_ID',\n",
    "               'PARENT_AREA_ID',\n",
    "               'AREA_SHORT_CODE',\n",
    "               'AREA_LONG_CODE',\n",
    "               'AREA_DESC',\n",
    "               'X',\n",
    "               'Y',\n",
    "               'OBJECTID',\n",
    "               'Shape__Area',\n",
    "               'Shape__Length',\n",
    "               'geometry'], axis=1, inplace=True)\n",
    "coord_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 191,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>AREA_NAME</th>\n",
       "      <th>LONGITUDE</th>\n",
       "      <th>LATITUDE</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>74</td>\n",
       "      <td>Agincourt North (129)</td>\n",
       "      <td>-79.266712</td>\n",
       "      <td>43.805441</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>75</td>\n",
       "      <td>Agincourt South-Malvern West (128)</td>\n",
       "      <td>-79.265612</td>\n",
       "      <td>43.788658</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>76</td>\n",
       "      <td>Alderwood (20)</td>\n",
       "      <td>-79.541611</td>\n",
       "      <td>43.604937</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>77</td>\n",
       "      <td>Annex (95)</td>\n",
       "      <td>-79.404001</td>\n",
       "      <td>43.671585</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>78</td>\n",
       "      <td>Banbury-Don Mills (42)</td>\n",
       "      <td>-79.349718</td>\n",
       "      <td>43.737657</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                             AREA_NAME  LONGITUDE   LATITUDE\n",
       "74               Agincourt North (129) -79.266712  43.805441\n",
       "75  Agincourt South-Malvern West (128) -79.265612  43.788658\n",
       "76                      Alderwood (20) -79.541611  43.604937\n",
       "77                          Annex (95) -79.404001  43.671585\n",
       "78              Banbury-Don Mills (42) -79.349718  43.737657"
      ]
     },
     "execution_count": 191,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#sort coordinates by alphabetical order\n",
    "coord_df.sort_values('AREA_NAME', inplace=True, ascending=True)\n",
    "coord_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 192,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>AREA_NAME</th>\n",
       "      <th>LONGITUDE</th>\n",
       "      <th>LATITUDE</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>0</td>\n",
       "      <td>Agincourt North (129)</td>\n",
       "      <td>-79.266712</td>\n",
       "      <td>43.805441</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>Agincourt South-Malvern West (128)</td>\n",
       "      <td>-79.265612</td>\n",
       "      <td>43.788658</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>Alderwood (20)</td>\n",
       "      <td>-79.541611</td>\n",
       "      <td>43.604937</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>Annex (95)</td>\n",
       "      <td>-79.404001</td>\n",
       "      <td>43.671585</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>Banbury-Don Mills (42)</td>\n",
       "      <td>-79.349718</td>\n",
       "      <td>43.737657</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                            AREA_NAME  LONGITUDE   LATITUDE\n",
       "0               Agincourt North (129) -79.266712  43.805441\n",
       "1  Agincourt South-Malvern West (128) -79.265612  43.788658\n",
       "2                      Alderwood (20) -79.541611  43.604937\n",
       "3                          Annex (95) -79.404001  43.671585\n",
       "4              Banbury-Don Mills (42) -79.349718  43.737657"
      ]
     },
     "execution_count": 192,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#reset index to match nb_df dataframe\n",
    "coord_df.reset_index(drop=True, inplace=True)\n",
    "coord_df.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### SInce both neighbourhood census and coordinate data come from the same source, they have the exact same list of neighbourhoods\n",
    "### Merge the two dataframes"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 193,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Neighbourhood</th>\n",
       "      <th>Population 2016</th>\n",
       "      <th>Working Age (25-54)</th>\n",
       "      <th>Avg. Total Income</th>\n",
       "      <th>Total Higher Education</th>\n",
       "      <th>Total Employment Rate</th>\n",
       "      <th>AREA_NAME</th>\n",
       "      <th>LONGITUDE</th>\n",
       "      <th>LATITUDE</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>0</td>\n",
       "      <td>Agincourt.North</td>\n",
       "      <td>29,113</td>\n",
       "      <td>11,305</td>\n",
       "      <td>30,414</td>\n",
       "      <td>25000</td>\n",
       "      <td>50.0</td>\n",
       "      <td>Agincourt North (129)</td>\n",
       "      <td>-79.266712</td>\n",
       "      <td>43.805441</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>Agincourt.South.Malvern.West</td>\n",
       "      <td>23,757</td>\n",
       "      <td>9,965</td>\n",
       "      <td>31,825</td>\n",
       "      <td>20400</td>\n",
       "      <td>53.2</td>\n",
       "      <td>Agincourt South-Malvern West (128)</td>\n",
       "      <td>-79.265612</td>\n",
       "      <td>43.788658</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>Alderwood</td>\n",
       "      <td>12,054</td>\n",
       "      <td>5,220</td>\n",
       "      <td>47,709</td>\n",
       "      <td>10265</td>\n",
       "      <td>62.4</td>\n",
       "      <td>Alderwood (20)</td>\n",
       "      <td>-79.541611</td>\n",
       "      <td>43.604937</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>Annex</td>\n",
       "      <td>30,526</td>\n",
       "      <td>15,040</td>\n",
       "      <td>112,766</td>\n",
       "      <td>26290</td>\n",
       "      <td>65.8</td>\n",
       "      <td>Annex (95)</td>\n",
       "      <td>-79.404001</td>\n",
       "      <td>43.671585</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>Banbury.Don.Mills</td>\n",
       "      <td>27,695</td>\n",
       "      <td>10,810</td>\n",
       "      <td>67,757</td>\n",
       "      <td>23390</td>\n",
       "      <td>55.6</td>\n",
       "      <td>Banbury-Don Mills (42)</td>\n",
       "      <td>-79.349718</td>\n",
       "      <td>43.737657</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                  Neighbourhood Population 2016 Working Age (25-54)  \\\n",
       "0               Agincourt.North          29,113              11,305   \n",
       "1  Agincourt.South.Malvern.West          23,757               9,965   \n",
       "2                     Alderwood          12,054               5,220   \n",
       "3                         Annex          30,526              15,040   \n",
       "4             Banbury.Don.Mills          27,695              10,810   \n",
       "\n",
       "  Avg. Total Income  Total Higher Education  Total Employment Rate  \\\n",
       "0            30,414                   25000                   50.0   \n",
       "1            31,825                   20400                   53.2   \n",
       "2            47,709                   10265                   62.4   \n",
       "3           112,766                   26290                   65.8   \n",
       "4            67,757                   23390                   55.6   \n",
       "\n",
       "                            AREA_NAME  LONGITUDE   LATITUDE  \n",
       "0               Agincourt North (129) -79.266712  43.805441  \n",
       "1  Agincourt South-Malvern West (128) -79.265612  43.788658  \n",
       "2                      Alderwood (20) -79.541611  43.604937  \n",
       "3                          Annex (95) -79.404001  43.671585  \n",
       "4              Banbury-Don Mills (42) -79.349718  43.737657  "
      ]
     },
     "execution_count": 193,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#merge coordinate and neighbourhood dataframes\n",
    "nb_coord_df= pd.merge(neighbourhood_df, coord_df, left_index=True, right_index=True, how='inner')\n",
    "nb_coord_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 194,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Neighbourhood</th>\n",
       "      <th>Population 2016</th>\n",
       "      <th>Working Age (25-54)</th>\n",
       "      <th>Avg. Total Income</th>\n",
       "      <th>Total Higher Education</th>\n",
       "      <th>Total Employment Rate</th>\n",
       "      <th>Long</th>\n",
       "      <th>Lat</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>0</td>\n",
       "      <td>Agincourt.North</td>\n",
       "      <td>29,113</td>\n",
       "      <td>11,305</td>\n",
       "      <td>30,414</td>\n",
       "      <td>25000</td>\n",
       "      <td>50.0</td>\n",
       "      <td>-79.266712</td>\n",
       "      <td>43.805441</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>Agincourt.South.Malvern.West</td>\n",
       "      <td>23,757</td>\n",
       "      <td>9,965</td>\n",
       "      <td>31,825</td>\n",
       "      <td>20400</td>\n",
       "      <td>53.2</td>\n",
       "      <td>-79.265612</td>\n",
       "      <td>43.788658</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>Alderwood</td>\n",
       "      <td>12,054</td>\n",
       "      <td>5,220</td>\n",
       "      <td>47,709</td>\n",
       "      <td>10265</td>\n",
       "      <td>62.4</td>\n",
       "      <td>-79.541611</td>\n",
       "      <td>43.604937</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>Annex</td>\n",
       "      <td>30,526</td>\n",
       "      <td>15,040</td>\n",
       "      <td>112,766</td>\n",
       "      <td>26290</td>\n",
       "      <td>65.8</td>\n",
       "      <td>-79.404001</td>\n",
       "      <td>43.671585</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>Banbury.Don.Mills</td>\n",
       "      <td>27,695</td>\n",
       "      <td>10,810</td>\n",
       "      <td>67,757</td>\n",
       "      <td>23390</td>\n",
       "      <td>55.6</td>\n",
       "      <td>-79.349718</td>\n",
       "      <td>43.737657</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                  Neighbourhood Population 2016 Working Age (25-54)  \\\n",
       "0               Agincourt.North          29,113              11,305   \n",
       "1  Agincourt.South.Malvern.West          23,757               9,965   \n",
       "2                     Alderwood          12,054               5,220   \n",
       "3                         Annex          30,526              15,040   \n",
       "4             Banbury.Don.Mills          27,695              10,810   \n",
       "\n",
       "  Avg. Total Income  Total Higher Education  Total Employment Rate       Long  \\\n",
       "0            30,414                   25000                   50.0 -79.266712   \n",
       "1            31,825                   20400                   53.2 -79.265612   \n",
       "2            47,709                   10265                   62.4 -79.541611   \n",
       "3           112,766                   26290                   65.8 -79.404001   \n",
       "4            67,757                   23390                   55.6 -79.349718   \n",
       "\n",
       "         Lat  \n",
       "0  43.805441  \n",
       "1  43.788658  \n",
       "2  43.604937  \n",
       "3  43.671585  \n",
       "4  43.737657  "
      ]
     },
     "execution_count": 194,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#clean up new dataframe\n",
    "nb_coord_df.drop('AREA_NAME', axis=1, inplace=True)\n",
    "\n",
    "#rename columns\n",
    "nb_coord_df.rename({'LONGITUDE': 'Long', \n",
    "                'LATITUDE': 'Lat'}, axis='columns', inplace=True)\n",
    "\n",
    "nb_coord_df.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# 2 - Data Exploration & Normalization"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Review Data-Types"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 195,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Data type of each column of Dataframe :\n",
      "Neighbourhood              object\n",
      "Population 2016            object\n",
      "Working Age (25-54)        object\n",
      "Avg. Total Income          object\n",
      "Total Higher Education      int64\n",
      "Total Employment Rate     float64\n",
      "Long                      float64\n",
      "Lat                       float64\n",
      "dtype: object\n"
     ]
    }
   ],
   "source": [
    "#check datatypes of each column first\n",
    "\n",
    "DataFrameTypes = nb_coord_df.dtypes\n",
    "\n",
    "print('Data type of each column of Dataframe :')\n",
    "print(DataFrameTypes)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 196,
   "metadata": {},
   "outputs": [],
   "source": [
    "#change Population 2016 to integer-type\n",
    "\n",
    "nb_coord_df['Population 2016'] = nb_coord_df['Population 2016'].str.replace(',', '')\n",
    "nb_coord_df[\"Population 2016\"] = nb_coord_df['Population 2016'].astype('int64')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 197,
   "metadata": {},
   "outputs": [],
   "source": [
    "#change Working Age (25-54) to integer-type\n",
    "\n",
    "nb_coord_df['Working Age (25-54)'] = nb_coord_df['Working Age (25-54)'].str.replace(',', '')\n",
    "nb_coord_df['Working Age (25-54)'] = nb_coord_df['Working Age (25-54)'].astype('int64')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 198,
   "metadata": {},
   "outputs": [],
   "source": [
    "#change Avg. Total Income to integer-type\n",
    "\n",
    "nb_coord_df['Avg. Total Income'] = nb_coord_df['Avg. Total Income'].str.replace(',', '')\n",
    "nb_coord_df['Avg. Total Income'] = nb_coord_df['Avg. Total Income'].astype('int64')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 199,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Data type of each column of Dataframe :\n",
      "Neighbourhood              object\n",
      "Population 2016             int64\n",
      "Working Age (25-54)         int64\n",
      "Avg. Total Income           int64\n",
      "Total Higher Education      int64\n",
      "Total Employment Rate     float64\n",
      "Long                      float64\n",
      "Lat                       float64\n",
      "dtype: object\n"
     ]
    }
   ],
   "source": [
    "#check datatypes again\n",
    "\n",
    "DataFrameTypes = nb_coord_df.dtypes\n",
    "print('Data type of each column of Dataframe :')\n",
    "print(DataFrameTypes)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Normalize Scores"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 200,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>0</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>0</td>\n",
       "      <td>0.379803</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>0.289538</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>0.092305</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>0.403617</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>0.355905</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "          0\n",
       "0  0.379803\n",
       "1  0.289538\n",
       "2  0.092305\n",
       "3  0.403617\n",
       "4  0.355905"
      ]
     },
     "execution_count": 200,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#Population 2016 normalized score\n",
    "\n",
    "scaler = preprocessing.MinMaxScaler()\n",
    "\n",
    "int_array = nb_coord_df['Population 2016'].values\n",
    "int_array_reshape = int_array.reshape(-1, 1)\n",
    "\n",
    "scaled_population_df = scaler.fit_transform(int_array_reshape)\n",
    "scaled_population_df = pd.DataFrame(scaled_population_df)\n",
    "scaled_population_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 201,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>0</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>0</td>\n",
       "      <td>0.201983</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>0.170346</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>0.058317</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>0.290166</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>0.190296</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "          0\n",
       "0  0.201983\n",
       "1  0.170346\n",
       "2  0.058317\n",
       "3  0.290166\n",
       "4  0.190296"
      ]
     },
     "execution_count": 201,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#Working Age (25-54) normalized score\n",
    "\n",
    "scaler = preprocessing.MinMaxScaler()\n",
    "\n",
    "int_array = nb_coord_df['Working Age (25-54)'].values\n",
    "int_array_reshape = int_array.reshape(-1, 1)\n",
    "\n",
    "scaled_workingage_df = scaler.fit_transform(int_array_reshape)\n",
    "scaled_workingage_df = pd.DataFrame(scaled_workingage_df)\n",
    "scaled_workingage_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 202,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>0</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>0</td>\n",
       "      <td>0.015690</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>0.020693</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>0.077016</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>0.307697</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>0.148102</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "          0\n",
       "0  0.015690\n",
       "1  0.020693\n",
       "2  0.077016\n",
       "3  0.307697\n",
       "4  0.148102"
      ]
     },
     "execution_count": 202,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#Avg. Total Income normalized score\n",
    "\n",
    "scaler = preprocessing.MinMaxScaler()\n",
    "\n",
    "int_array = nb_coord_df['Avg. Total Income'].values\n",
    "int_array_reshape = int_array.reshape(-1, 1)\n",
    "\n",
    "scaled_income_df = scaler.fit_transform(int_array_reshape)\n",
    "scaled_income_df = pd.DataFrame(scaled_income_df)\n",
    "scaled_income_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 203,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>0</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>0</td>\n",
       "      <td>0.348022</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>0.266943</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>0.088305</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>0.370759</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>0.319644</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "          0\n",
       "0  0.348022\n",
       "1  0.266943\n",
       "2  0.088305\n",
       "3  0.370759\n",
       "4  0.319644"
      ]
     },
     "execution_count": 203,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#Total Higher Education normalized score\n",
    "\n",
    "scaler = preprocessing.MinMaxScaler()\n",
    "\n",
    "int_array = nb_coord_df['Total Higher Education'].values\n",
    "int_array_reshape = int_array.reshape(-1, 1)\n",
    "\n",
    "scaled_education_df = scaler.fit_transform(int_array_reshape)\n",
    "scaled_education_df = pd.DataFrame(scaled_education_df)\n",
    "scaled_education_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 204,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>0</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>0</td>\n",
       "      <td>0.076271</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>0.166667</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>0.426554</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>0.522599</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>0.234463</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "          0\n",
       "0  0.076271\n",
       "1  0.166667\n",
       "2  0.426554\n",
       "3  0.522599\n",
       "4  0.234463"
      ]
     },
     "execution_count": 204,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Total Employment Rate normalized score\n",
    "\n",
    "scaler = preprocessing.MinMaxScaler()\n",
    "\n",
    "int_array = nb_coord_df['Total Employment Rate'].values\n",
    "int_array_reshape = int_array.reshape(-1, 1)\n",
    "\n",
    "scaled_employment_df = scaler.fit_transform(int_array_reshape)\n",
    "scaled_employment_df = pd.DataFrame(scaled_employment_df)\n",
    "scaled_employment_df.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Combine the 5 normalized dataframes into one new dataframe"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 205,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Population 2016</th>\n",
       "      <th>Working Age (25-54)</th>\n",
       "      <th>Avg. Total Income</th>\n",
       "      <th>Total Higher Education</th>\n",
       "      <th>Total Employment Rate</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>0</td>\n",
       "      <td>0.379803</td>\n",
       "      <td>0.201983</td>\n",
       "      <td>0.015690</td>\n",
       "      <td>0.348022</td>\n",
       "      <td>0.076271</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>0.289538</td>\n",
       "      <td>0.170346</td>\n",
       "      <td>0.020693</td>\n",
       "      <td>0.266943</td>\n",
       "      <td>0.166667</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>0.092305</td>\n",
       "      <td>0.058317</td>\n",
       "      <td>0.077016</td>\n",
       "      <td>0.088305</td>\n",
       "      <td>0.426554</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>0.403617</td>\n",
       "      <td>0.290166</td>\n",
       "      <td>0.307697</td>\n",
       "      <td>0.370759</td>\n",
       "      <td>0.522599</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>0.355905</td>\n",
       "      <td>0.190296</td>\n",
       "      <td>0.148102</td>\n",
       "      <td>0.319644</td>\n",
       "      <td>0.234463</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   Population 2016  Working Age (25-54)  Avg. Total Income  \\\n",
       "0         0.379803             0.201983           0.015690   \n",
       "1         0.289538             0.170346           0.020693   \n",
       "2         0.092305             0.058317           0.077016   \n",
       "3         0.403617             0.290166           0.307697   \n",
       "4         0.355905             0.190296           0.148102   \n",
       "\n",
       "   Total Higher Education  Total Employment Rate  \n",
       "0                0.348022               0.076271  \n",
       "1                0.266943               0.166667  \n",
       "2                0.088305               0.426554  \n",
       "3                0.370759               0.522599  \n",
       "4                0.319644               0.234463  "
      ]
     },
     "execution_count": 205,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#merge columns and rename \n",
    "\n",
    "scores_df = pd.merge(scaled_population_df, scaled_workingage_df, left_index=True, right_index=True, how='inner')\n",
    "scores_df = pd.merge(scores_df, scaled_income_df, left_index=True, right_index=True, how='inner')\n",
    "scores_df = pd.merge(scores_df, scaled_education_df, left_index=True, right_index=True, how='inner')\n",
    "scores_df = pd.merge(scores_df, scaled_employment_df, left_index=True, right_index=True, how='inner')\n",
    "\n",
    "scores_df.columns = [\"Population 2016\",\n",
    "                     \"Working Age (25-54)\",\n",
    "                     \"Avg. Total Income\",\n",
    "                     \"Total Higher Education\",\n",
    "                     \"Total Employment Rate\"]\n",
    "\n",
    "scores_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 206,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Population 2016</th>\n",
       "      <th>Working Age (25-54)</th>\n",
       "      <th>Avg. Total Income</th>\n",
       "      <th>Total Higher Education</th>\n",
       "      <th>Total Employment Rate</th>\n",
       "      <th>Total Score</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>0</td>\n",
       "      <td>0.379803</td>\n",
       "      <td>0.201983</td>\n",
       "      <td>0.015690</td>\n",
       "      <td>0.348022</td>\n",
       "      <td>0.076271</td>\n",
       "      <td>1.021769</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>0.289538</td>\n",
       "      <td>0.170346</td>\n",
       "      <td>0.020693</td>\n",
       "      <td>0.266943</td>\n",
       "      <td>0.166667</td>\n",
       "      <td>0.914186</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>0.092305</td>\n",
       "      <td>0.058317</td>\n",
       "      <td>0.077016</td>\n",
       "      <td>0.088305</td>\n",
       "      <td>0.426554</td>\n",
       "      <td>0.742496</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>0.403617</td>\n",
       "      <td>0.290166</td>\n",
       "      <td>0.307697</td>\n",
       "      <td>0.370759</td>\n",
       "      <td>0.522599</td>\n",
       "      <td>1.894838</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>0.355905</td>\n",
       "      <td>0.190296</td>\n",
       "      <td>0.148102</td>\n",
       "      <td>0.319644</td>\n",
       "      <td>0.234463</td>\n",
       "      <td>1.248411</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   Population 2016  Working Age (25-54)  Avg. Total Income  \\\n",
       "0         0.379803             0.201983           0.015690   \n",
       "1         0.289538             0.170346           0.020693   \n",
       "2         0.092305             0.058317           0.077016   \n",
       "3         0.403617             0.290166           0.307697   \n",
       "4         0.355905             0.190296           0.148102   \n",
       "\n",
       "   Total Higher Education  Total Employment Rate  Total Score  \n",
       "0                0.348022               0.076271     1.021769  \n",
       "1                0.266943               0.166667     0.914186  \n",
       "2                0.088305               0.426554     0.742496  \n",
       "3                0.370759               0.522599     1.894838  \n",
       "4                0.319644               0.234463     1.248411  "
      ]
     },
     "execution_count": 206,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#append column for total score (sum)\n",
    "\n",
    "scores_df['Total Score'] = scores_df.sum(axis=1)\n",
    "scores_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 207,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Neighbourhood</th>\n",
       "      <th>Population 2016</th>\n",
       "      <th>Working Age (25-54)</th>\n",
       "      <th>Avg. Total Income</th>\n",
       "      <th>Total Higher Education</th>\n",
       "      <th>Total Employment Rate</th>\n",
       "      <th>Long</th>\n",
       "      <th>Lat</th>\n",
       "      <th>Total Score</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>0</td>\n",
       "      <td>Agincourt.North</td>\n",
       "      <td>29113</td>\n",
       "      <td>11305</td>\n",
       "      <td>30414</td>\n",
       "      <td>25000</td>\n",
       "      <td>50.0</td>\n",
       "      <td>-79.266712</td>\n",
       "      <td>43.805441</td>\n",
       "      <td>1.021769</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>Agincourt.South.Malvern.West</td>\n",
       "      <td>23757</td>\n",
       "      <td>9965</td>\n",
       "      <td>31825</td>\n",
       "      <td>20400</td>\n",
       "      <td>53.2</td>\n",
       "      <td>-79.265612</td>\n",
       "      <td>43.788658</td>\n",
       "      <td>0.914186</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>Alderwood</td>\n",
       "      <td>12054</td>\n",
       "      <td>5220</td>\n",
       "      <td>47709</td>\n",
       "      <td>10265</td>\n",
       "      <td>62.4</td>\n",
       "      <td>-79.541611</td>\n",
       "      <td>43.604937</td>\n",
       "      <td>0.742496</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>Annex</td>\n",
       "      <td>30526</td>\n",
       "      <td>15040</td>\n",
       "      <td>112766</td>\n",
       "      <td>26290</td>\n",
       "      <td>65.8</td>\n",
       "      <td>-79.404001</td>\n",
       "      <td>43.671585</td>\n",
       "      <td>1.894838</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>Banbury.Don.Mills</td>\n",
       "      <td>27695</td>\n",
       "      <td>10810</td>\n",
       "      <td>67757</td>\n",
       "      <td>23390</td>\n",
       "      <td>55.6</td>\n",
       "      <td>-79.349718</td>\n",
       "      <td>43.737657</td>\n",
       "      <td>1.248411</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>135</td>\n",
       "      <td>Wychwood</td>\n",
       "      <td>14349</td>\n",
       "      <td>6420</td>\n",
       "      <td>54460</td>\n",
       "      <td>11385</td>\n",
       "      <td>65.6</td>\n",
       "      <td>-79.425515</td>\n",
       "      <td>43.676919</td>\n",
       "      <td>0.943580</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>136</td>\n",
       "      <td>Yonge.Eglinton</td>\n",
       "      <td>11817</td>\n",
       "      <td>5860</td>\n",
       "      <td>89330</td>\n",
       "      <td>10000</td>\n",
       "      <td>68.2</td>\n",
       "      <td>-79.403590</td>\n",
       "      <td>43.704689</td>\n",
       "      <td>1.060364</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>137</td>\n",
       "      <td>Yonge.St.Clair</td>\n",
       "      <td>12528</td>\n",
       "      <td>5960</td>\n",
       "      <td>114174</td>\n",
       "      <td>11100</td>\n",
       "      <td>65.2</td>\n",
       "      <td>-79.397871</td>\n",
       "      <td>43.687859</td>\n",
       "      <td>1.097443</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>138</td>\n",
       "      <td>York.University.Heights</td>\n",
       "      <td>27593</td>\n",
       "      <td>12290</td>\n",
       "      <td>29958</td>\n",
       "      <td>23520</td>\n",
       "      <td>56.3</td>\n",
       "      <td>-79.488883</td>\n",
       "      <td>43.765736</td>\n",
       "      <td>1.169671</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>139</td>\n",
       "      <td>Yorkdale.Glen.Park</td>\n",
       "      <td>14804</td>\n",
       "      <td>5860</td>\n",
       "      <td>38527</td>\n",
       "      <td>12065</td>\n",
       "      <td>55.3</td>\n",
       "      <td>-79.457108</td>\n",
       "      <td>43.714672</td>\n",
       "      <td>0.602556</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>140 rows Ã— 9 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                    Neighbourhood  Population 2016  Working Age (25-54)  \\\n",
       "0                 Agincourt.North            29113                11305   \n",
       "1    Agincourt.South.Malvern.West            23757                 9965   \n",
       "2                       Alderwood            12054                 5220   \n",
       "3                           Annex            30526                15040   \n",
       "4               Banbury.Don.Mills            27695                10810   \n",
       "..                            ...              ...                  ...   \n",
       "135                      Wychwood            14349                 6420   \n",
       "136                Yonge.Eglinton            11817                 5860   \n",
       "137                Yonge.St.Clair            12528                 5960   \n",
       "138       York.University.Heights            27593                12290   \n",
       "139            Yorkdale.Glen.Park            14804                 5860   \n",
       "\n",
       "     Avg. Total Income  Total Higher Education  Total Employment Rate  \\\n",
       "0                30414                   25000                   50.0   \n",
       "1                31825                   20400                   53.2   \n",
       "2                47709                   10265                   62.4   \n",
       "3               112766                   26290                   65.8   \n",
       "4                67757                   23390                   55.6   \n",
       "..                 ...                     ...                    ...   \n",
       "135              54460                   11385                   65.6   \n",
       "136              89330                   10000                   68.2   \n",
       "137             114174                   11100                   65.2   \n",
       "138              29958                   23520                   56.3   \n",
       "139              38527                   12065                   55.3   \n",
       "\n",
       "          Long        Lat  Total Score  \n",
       "0   -79.266712  43.805441     1.021769  \n",
       "1   -79.265612  43.788658     0.914186  \n",
       "2   -79.541611  43.604937     0.742496  \n",
       "3   -79.404001  43.671585     1.894838  \n",
       "4   -79.349718  43.737657     1.248411  \n",
       "..         ...        ...          ...  \n",
       "135 -79.425515  43.676919     0.943580  \n",
       "136 -79.403590  43.704689     1.060364  \n",
       "137 -79.397871  43.687859     1.097443  \n",
       "138 -79.488883  43.765736     1.169671  \n",
       "139 -79.457108  43.714672     0.602556  \n",
       "\n",
       "[140 rows x 9 columns]"
      ]
     },
     "execution_count": 207,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#append Total Score to nb_coord_df\n",
    "\n",
    "score_list = scores_df['Total Score']\n",
    "\n",
    "nb_coord_df['Total Score'] = score_list\n",
    "nb_coord_df"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# 3 - KMeans Clustering"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 208,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Neighbourhood</th>\n",
       "      <th>Population 2016</th>\n",
       "      <th>Working Age (25-54)</th>\n",
       "      <th>Avg. Total Income</th>\n",
       "      <th>Total Higher Education</th>\n",
       "      <th>Total Employment Rate</th>\n",
       "      <th>Long</th>\n",
       "      <th>Lat</th>\n",
       "      <th>Total Score</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>0</td>\n",
       "      <td>Waterfront.Communities.The.Island</td>\n",
       "      <td>65913</td>\n",
       "      <td>45105</td>\n",
       "      <td>70600</td>\n",
       "      <td>61990</td>\n",
       "      <td>78.2</td>\n",
       "      <td>-79.377202</td>\n",
       "      <td>43.633880</td>\n",
       "      <td>4.031065</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>Niagara</td>\n",
       "      <td>31180</td>\n",
       "      <td>23320</td>\n",
       "      <td>70623</td>\n",
       "      <td>28390</td>\n",
       "      <td>82.7</td>\n",
       "      <td>-79.412420</td>\n",
       "      <td>43.636681</td>\n",
       "      <td>2.466333</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>Willowdale.East</td>\n",
       "      <td>50434</td>\n",
       "      <td>25850</td>\n",
       "      <td>45326</td>\n",
       "      <td>44330</td>\n",
       "      <td>55.9</td>\n",
       "      <td>-79.401484</td>\n",
       "      <td>43.770602</td>\n",
       "      <td>2.284752</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>Islington.City.Centre.West</td>\n",
       "      <td>43965</td>\n",
       "      <td>20640</td>\n",
       "      <td>52787</td>\n",
       "      <td>37405</td>\n",
       "      <td>63.6</td>\n",
       "      <td>-79.543317</td>\n",
       "      <td>43.633463</td>\n",
       "      <td>2.174632</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>Woburn</td>\n",
       "      <td>53485</td>\n",
       "      <td>21945</td>\n",
       "      <td>30878</td>\n",
       "      <td>43410</td>\n",
       "      <td>51.9</td>\n",
       "      <td>-79.228586</td>\n",
       "      <td>43.766740</td>\n",
       "      <td>2.063534</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                       Neighbourhood  Population 2016  Working Age (25-54)  \\\n",
       "0  Waterfront.Communities.The.Island            65913                45105   \n",
       "1                            Niagara            31180                23320   \n",
       "2                    Willowdale.East            50434                25850   \n",
       "3         Islington.City.Centre.West            43965                20640   \n",
       "4                             Woburn            53485                21945   \n",
       "\n",
       "   Avg. Total Income  Total Higher Education  Total Employment Rate  \\\n",
       "0              70600                   61990                   78.2   \n",
       "1              70623                   28390                   82.7   \n",
       "2              45326                   44330                   55.9   \n",
       "3              52787                   37405                   63.6   \n",
       "4              30878                   43410                   51.9   \n",
       "\n",
       "        Long        Lat  Total Score  \n",
       "0 -79.377202  43.633880     4.031065  \n",
       "1 -79.412420  43.636681     2.466333  \n",
       "2 -79.401484  43.770602     2.284752  \n",
       "3 -79.543317  43.633463     2.174632  \n",
       "4 -79.228586  43.766740     2.063534  "
      ]
     },
     "execution_count": 208,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#Pick top-20 neighbourhoods by total score\n",
    "\n",
    "neighbourhood_top20_df = nb_coord_df.nlargest(20,['Total Score'])\n",
    "neighbourhood_top20_df.reset_index(drop=True, inplace=True)\n",
    "neighbourhood_top20_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 209,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([[4.03106461],\n",
       "       [2.4663334 ],\n",
       "       [2.28475182],\n",
       "       [2.17463163],\n",
       "       [2.06353364],\n",
       "       [2.01412936],\n",
       "       [1.93029842],\n",
       "       [1.91836561],\n",
       "       [1.89483775],\n",
       "       [1.89381241],\n",
       "       [1.84043757],\n",
       "       [1.76831429],\n",
       "       [1.64665135],\n",
       "       [1.61365316],\n",
       "       [1.59521708],\n",
       "       [1.5277349 ],\n",
       "       [1.51743306],\n",
       "       [1.49082532],\n",
       "       [1.45301892],\n",
       "       [1.433451  ]])"
      ]
     },
     "execution_count": 209,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "topscore_top20_array = neighbourhood_top20_df['Total Score'].values\n",
    "topscore_top20_array_reshape = topscore_top20_array.reshape(-1, 1)\n",
    "\n",
    "topscore_top20_array_reshape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 210,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2])"
      ]
     },
     "execution_count": 210,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#run k-means clustering\n",
    "kmeans = KMeans(n_clusters=3)\n",
    "kmeans_scores = kmeans.fit(topscore_top20_array_reshape)\n",
    "\n",
    "#check cluster labels generated for each row in the dataframe\n",
    "kmeans_scores.labels_[0:20]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 211,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Neighbourhood</th>\n",
       "      <th>Cluster Labels</th>\n",
       "      <th>Population 2016</th>\n",
       "      <th>Working Age (25-54)</th>\n",
       "      <th>Avg. Total Income</th>\n",
       "      <th>Total Higher Education</th>\n",
       "      <th>Total Employment Rate</th>\n",
       "      <th>Long</th>\n",
       "      <th>Lat</th>\n",
       "      <th>Total Score</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <td>0</td>\n",
       "      <td>Waterfront.Communities.The.Island</td>\n",
       "      <td>1</td>\n",
       "      <td>65913</td>\n",
       "      <td>45105</td>\n",
       "      <td>70600</td>\n",
       "      <td>61990</td>\n",
       "      <td>78.2</td>\n",
       "      <td>-79.377202</td>\n",
       "      <td>43.633880</td>\n",
       "      <td>4.031065</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>1</td>\n",
       "      <td>Niagara</td>\n",
       "      <td>0</td>\n",
       "      <td>31180</td>\n",
       "      <td>23320</td>\n",
       "      <td>70623</td>\n",
       "      <td>28390</td>\n",
       "      <td>82.7</td>\n",
       "      <td>-79.412420</td>\n",
       "      <td>43.636681</td>\n",
       "      <td>2.466333</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>2</td>\n",
       "      <td>Willowdale.East</td>\n",
       "      <td>0</td>\n",
       "      <td>50434</td>\n",
       "      <td>25850</td>\n",
       "      <td>45326</td>\n",
       "      <td>44330</td>\n",
       "      <td>55.9</td>\n",
       "      <td>-79.401484</td>\n",
       "      <td>43.770602</td>\n",
       "      <td>2.284752</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>3</td>\n",
       "      <td>Islington.City.Centre.West</td>\n",
       "      <td>0</td>\n",
       "      <td>43965</td>\n",
       "      <td>20640</td>\n",
       "      <td>52787</td>\n",
       "      <td>37405</td>\n",
       "      <td>63.6</td>\n",
       "      <td>-79.543317</td>\n",
       "      <td>43.633463</td>\n",
       "      <td>2.174632</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <td>4</td>\n",
       "      <td>Woburn</td>\n",
       "      <td>0</td>\n",
       "      <td>53485</td>\n",
       "      <td>21945</td>\n",
       "      <td>30878</td>\n",
       "      <td>43410</td>\n",
       "      <td>51.9</td>\n",
       "      <td>-79.228586</td>\n",
       "      <td>43.766740</td>\n",
       "      <td>2.063534</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                       Neighbourhood  Cluster Labels  Population 2016  \\\n",
       "0  Waterfront.Communities.The.Island               1            65913   \n",
       "1                            Niagara               0            31180   \n",
       "2                    Willowdale.East               0            50434   \n",
       "3         Islington.City.Centre.West               0            43965   \n",
       "4                             Woburn               0            53485   \n",
       "\n",
       "   Working Age (25-54)  Avg. Total Income  Total Higher Education  \\\n",
       "0                45105              70600                   61990   \n",
       "1                23320              70623                   28390   \n",
       "2                25850              45326                   44330   \n",
       "3                20640              52787                   37405   \n",
       "4                21945              30878                   43410   \n",
       "\n",
       "   Total Employment Rate       Long        Lat  Total Score  \n",
       "0                   78.2 -79.377202  43.633880     4.031065  \n",
       "1                   82.7 -79.412420  43.636681     2.466333  \n",
       "2                   55.9 -79.401484  43.770602     2.284752  \n",
       "3                   63.6 -79.543317  43.633463     2.174632  \n",
       "4                   51.9 -79.228586  43.766740     2.063534  "
      ]
     },
     "execution_count": 211,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#add clustering labels to neighbourhood_top20_df\n",
    "neighbourhood_top20_df.insert(1, 'Cluster Labels', kmeans_scores.labels_)\n",
    "\n",
    "neighbourhood_top20_df.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# 4 - Create Toronto Map\n",
    "### Final output will include a map of the Top-20 neighbourhoods in which a condominium developer should focus on expanding into. The neighbourhoods are clustered by total score and 3 clusters were used in KMeans clustering."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 241,
   "metadata": {},
   "outputs": [],
   "source": [
    "#create map of Toronto using first entries latitude and longitude values\n",
    "map_toronto = folium.Map(location=[neighbourhood_top20_df[\"Lat\"][0], neighbourhood_top20_df[\"Long\"][0]], zoom_start=10)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 242,
   "metadata": {},
   "outputs": [],
   "source": [
    "#set color scheme for the clusters\n",
    "x = np.arange(3)\n",
    "ys = [i + x + (i*x)**2 for i in range(3)]\n",
    "colors_array = cm.prism(np.linspace(0, 1, len(ys)))\n",
    "rainbow = [colors.rgb2hex(i) for i in colors_array]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 243,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div style=\"width:100%;\"><div style=\"position:relative;width:100%;height:0;padding-bottom:60%;\"><iframe src=\"data:text/html;charset=utf-8;base64,PCFET0NUWVBFIGh0bWw+CjxoZWFkPiAgICAKICAgIDxtZXRhIGh0dHAtZXF1aXY9ImNvbnRlbnQtdHlwZSIgY29udGVudD0idGV4dC9odG1sOyBjaGFyc2V0PVVURi04IiAvPgogICAgPHNjcmlwdD5MX1BSRUZFUl9DQU5WQVMgPSBmYWxzZTsgTF9OT19UT1VDSCA9IGZhbHNlOyBMX0RJU0FCTEVfM0QgPSBmYWxzZTs8L3NjcmlwdD4KICAgIDxzY3JpcHQgc3JjPSJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2xlYWZsZXRAMS4yLjAvZGlzdC9sZWFmbGV0LmpzIj48L3NjcmlwdD4KICAgIDxzY3JpcHQgc3JjPSJodHRwczovL2FqYXguZ29vZ2xlYXBpcy5jb20vYWpheC9saWJzL2pxdWVyeS8xLjExLjEvanF1ZXJ5Lm1pbi5qcyI+PC9zY3JpcHQ+CiAgICA8c2NyaXB0IHNyYz0iaHR0cHM6Ly9tYXhjZG4uYm9vdHN0cmFwY2RuLmNvbS9ib290c3RyYXAvMy4yLjAvanMvYm9vdHN0cmFwLm1pbi5qcyI+PC9zY3JpcHQ+CiAgICA8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvTGVhZmxldC5hd2Vzb21lLW1hcmtlcnMvMi4wLjIvbGVhZmxldC5hd2Vzb21lLW1hcmtlcnMuanMiPjwvc2NyaXB0PgogICAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2xlYWZsZXRAMS4yLjAvZGlzdC9sZWFmbGV0LmNzcyIvPgogICAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJodHRwczovL21heGNkbi5ib290c3RyYXBjZG4uY29tL2Jvb3RzdHJhcC8zLjIuMC9jc3MvYm9vdHN0cmFwLm1pbi5jc3MiLz4KICAgIDxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0iaHR0cHM6Ly9tYXhjZG4uYm9vdHN0cmFwY2RuLmNvbS9ib290c3RyYXAvMy4yLjAvY3NzL2Jvb3RzdHJhcC10aGVtZS5taW4uY3NzIi8+CiAgICA8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9Imh0dHBzOi8vbWF4Y2RuLmJvb3RzdHJhcGNkbi5jb20vZm9udC1hd2Vzb21lLzQuNi4zL2Nzcy9mb250LWF3ZXNvbWUubWluLmNzcyIvPgogICAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJodHRwczovL2NkbmpzLmNsb3VkZmxhcmUuY29tL2FqYXgvbGlicy9MZWFmbGV0LmF3ZXNvbWUtbWFya2Vycy8yLjAuMi9sZWFmbGV0LmF3ZXNvbWUtbWFya2Vycy5jc3MiLz4KICAgIDxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0iaHR0cHM6Ly9yYXdnaXQuY29tL3B5dGhvbi12aXN1YWxpemF0aW9uL2ZvbGl1bS9tYXN0ZXIvZm9saXVtL3RlbXBsYXRlcy9sZWFmbGV0LmF3ZXNvbWUucm90YXRlLmNzcyIvPgogICAgPHN0eWxlPmh0bWwsIGJvZHkge3dpZHRoOiAxMDAlO2hlaWdodDogMTAwJTttYXJnaW46IDA7cGFkZGluZzogMDt9PC9zdHlsZT4KICAgIDxzdHlsZT4jbWFwIHtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtib3R0b206MDtyaWdodDowO2xlZnQ6MDt9PC9zdHlsZT4KICAgIAogICAgICAgICAgICA8c3R5bGU+ICNtYXBfYzZiMWE0NWM5OTEzNGM1MmFhZjg1NWZkN2E1YzNmM2EgewogICAgICAgICAgICAgICAgcG9zaXRpb24gOiByZWxhdGl2ZTsKICAgICAgICAgICAgICAgIHdpZHRoIDogMTAwLjAlOwogICAgICAgICAgICAgICAgaGVpZ2h0OiAxMDAuMCU7CiAgICAgICAgICAgICAgICBsZWZ0OiAwLjAlOwogICAgICAgICAgICAgICAgdG9wOiAwLjAlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICA8L3N0eWxlPgogICAgICAgIAo8L2hlYWQ+Cjxib2R5PiAgICAKICAgIAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb2xpdW0tbWFwIiBpZD0ibWFwX2M2YjFhNDVjOTkxMzRjNTJhYWY4NTVmZDdhNWMzZjNhIiA+PC9kaXY+CiAgICAgICAgCjwvYm9keT4KPHNjcmlwdD4gICAgCiAgICAKCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdmFyIGJvdW5kcyA9IG51bGw7CiAgICAgICAgICAgIAoKICAgICAgICAgICAgdmFyIG1hcF9jNmIxYTQ1Yzk5MTM0YzUyYWFmODU1ZmQ3YTVjM2YzYSA9IEwubWFwKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ21hcF9jNmIxYTQ1Yzk5MTM0YzUyYWFmODU1ZmQ3YTVjM2YzYScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7Y2VudGVyOiBbNDMuNjMzODgwMzYyMywtNzkuMzc3MjAyMzE0Nl0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB6b29tOiAxMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heEJvdW5kczogYm91bmRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF5ZXJzOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmxkQ29weUp1bXA6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JzOiBMLkNSUy5FUFNHMzg1NwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgCiAgICAKICAgICAgICAgICAgdmFyIHRpbGVfbGF5ZXJfNTRlODU0OTAxMWFjNDNjY2EzODc0NzE2MjkzYzk5MzYgPSBMLnRpbGVMYXllcigKICAgICAgICAgICAgICAgICdodHRwczovL3tzfS50aWxlLm9wZW5zdHJlZXRtYXAub3JnL3t6fS97eH0ve3l9LnBuZycsCiAgICAgICAgICAgICAgICB7CiAgImF0dHJpYnV0aW9uIjogbnVsbCwKICAiZGV0ZWN0UmV0aW5hIjogZmFsc2UsCiAgIm1heFpvb20iOiAxOCwKICAibWluWm9vbSI6IDEsCiAgIm5vV3JhcCI6IGZhbHNlLAogICJzdWJkb21haW5zIjogImFiYyIKfQogICAgICAgICAgICAgICAgKS5hZGRUbyhtYXBfYzZiMWE0NWM5OTEzNGM1MmFhZjg1NWZkN2E1YzNmM2EpOwogICAgICAgIAogICAgCiAgICAgICAgICAgIHZhciBjaXJjbGVfbWFya2VyXzI0MWVkNzViMmM3NzQ0YzNiZWE4ZTNiZjRmZDY2NGI3ID0gTC5jaXJjbGVNYXJrZXIoCiAgICAgICAgICAgICAgICBbNDMuNjMzODgwMzYyMywtNzkuMzc3MjAyMzE0Nl0sCiAgICAgICAgICAgICAgICB7CiAgImJ1YmJsaW5nTW91c2VFdmVudHMiOiB0cnVlLAogICJjb2xvciI6ICIjZmYwMDAwIiwKICAiZGFzaEFycmF5IjogbnVsbCwKICAiZGFzaE9mZnNldCI6IG51bGwsCiAgImZpbGwiOiB0cnVlLAogICJmaWxsQ29sb3IiOiAiI2ZmMDAwMCIsCiAgImZpbGxPcGFjaXR5IjogMC45LAogICJmaWxsUnVsZSI6ICJldmVub2RkIiwKICAibGluZUNhcCI6ICJyb3VuZCIsCiAgImxpbmVKb2luIjogInJvdW5kIiwKICAib3BhY2l0eSI6IDEuMCwKICAicmFkaXVzIjogNSwKICAic3Ryb2tlIjogdHJ1ZSwKICAid2VpZ2h0IjogMwp9CiAgICAgICAgICAgICAgICApLmFkZFRvKG1hcF9jNmIxYTQ1Yzk5MTM0YzUyYWFmODU1ZmQ3YTVjM2YzYSk7CiAgICAgICAgICAgIAogICAgCiAgICAgICAgICAgIHZhciBwb3B1cF9jZDIxNzhiYzNkZTY0YzJjOGYxMzRiMjdmZDlkOTVkNiA9IEwucG9wdXAoe21heFdpZHRoOiAnMzAwJ30pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB2YXIgaHRtbF9jNzM2N2M3ZTFlMDA0MzM3OGQwZjBlYWRhZjYxMDhjMiA9ICQoJzxkaXYgaWQ9Imh0bWxfYzczNjdjN2UxZTAwNDMzNzhkMGYwZWFkYWY2MTA4YzIiIHN0eWxlPSJ3aWR0aDogMTAwLjAlOyBoZWlnaHQ6IDEwMC4wJTsiPldhdGVyZnJvbnQuQ29tbXVuaXRpZXMuVGhlLklzbGFuZCB+fn4gQ2x1c3RlcjogMTwvZGl2PicpWzBdOwogICAgICAgICAgICAgICAgcG9wdXBfY2QyMTc4YmMzZGU2NGMyYzhmMTM0YjI3ZmQ5ZDk1ZDYuc2V0Q29udGVudChodG1sX2M3MzY3YzdlMWUwMDQzMzc4ZDBmMGVhZGFmNjEwOGMyKTsKICAgICAgICAgICAgCgogICAgICAgICAgICBjaXJjbGVfbWFya2VyXzI0MWVkNzViMmM3NzQ0YzNiZWE4ZTNiZjRmZDY2NGI3LmJpbmRQb3B1cChwb3B1cF9jZDIxNzhiYzNkZTY0YzJjOGYxMzRiMjdmZDlkOTVkNik7CgogICAgICAgICAgICAKICAgICAgICAKICAgIAogICAgICAgICAgICB2YXIgY2lyY2xlX21hcmtlcl85Y2RmY2MzNTQ4OGM0MWNiOGNiMDczY2ZmZGUzODU4YyA9IEwuY2lyY2xlTWFya2VyKAogICAgICAgICAgICAgICAgWzQzLjYzNjY4MDg3OTEsLTc5LjQxMjQyMDQwMV0sCiAgICAgICAgICAgICAgICB7CiAgImJ1YmJsaW5nTW91c2VFdmVudHMiOiB0cnVlLAogICJjb2xvciI6ICIjNTRmZjAwIiwKICAiZGFzaEFycmF5IjogbnVsbCwKICAiZGFzaE9mZnNldCI6IG51bGwsCiAgImZpbGwiOiB0cnVlLAogICJmaWxsQ29sb3IiOiAiIzU0ZmYwMCIsCiAgImZpbGxPcGFjaXR5IjogMC45LAogICJmaWxsUnVsZSI6ICJldmVub2RkIiwKICAibGluZUNhcCI6ICJyb3VuZCIsCiAgImxpbmVKb2luIjogInJvdW5kIiwKICAib3BhY2l0eSI6IDEuMCwKICAicmFkaXVzIjogNSwKICAic3Ryb2tlIjogdHJ1ZSwKICAid2VpZ2h0IjogMwp9CiAgICAgICAgICAgICAgICApLmFkZFRvKG1hcF9jNmIxYTQ1Yzk5MTM0YzUyYWFmODU1ZmQ3YTVjM2YzYSk7CiAgICAgICAgICAgIAogICAgCiAgICAgICAgICAgIHZhciBwb3B1cF84NGViZDM1ODQxNzE0YmNjYTgwNGFkNjQ2MTA1OTU0MSA9IEwucG9wdXAoe21heFdpZHRoOiAnMzAwJ30pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB2YXIgaHRtbF8wMGZhOTBhNzkxZTU0YTBhODc4NDEzYzQyMzA5ZjgwZSA9ICQoJzxkaXYgaWQ9Imh0bWxfMDBmYTkwYTc5MWU1NGEwYTg3ODQxM2M0MjMwOWY4MGUiIHN0eWxlPSJ3aWR0aDogMTAwLjAlOyBoZWlnaHQ6IDEwMC4wJTsiPk5pYWdhcmEgfn5+IENsdXN0ZXI6IDA8L2Rpdj4nKVswXTsKICAgICAgICAgICAgICAgIHBvcHVwXzg0ZWJkMzU4NDE3MTRiY2NhODA0YWQ2NDYxMDU5NTQxLnNldENvbnRlbnQoaHRtbF8wMGZhOTBhNzkxZTU0YTBhODc4NDEzYzQyMzA5ZjgwZSk7CiAgICAgICAgICAgIAoKICAgICAgICAgICAgY2lyY2xlX21hcmtlcl85Y2RmY2MzNTQ4OGM0MWNiOGNiMDczY2ZmZGUzODU4Yy5iaW5kUG9wdXAocG9wdXBfODRlYmQzNTg0MTcxNGJjY2E4MDRhZDY0NjEwNTk1NDEpOwoKICAgICAgICAgICAgCiAgICAgICAgCiAgICAKICAgICAgICAgICAgdmFyIGNpcmNsZV9tYXJrZXJfMDQ3ZTc0OThkODk2NDkzODgwYWQ3YWJjM2I4OTM3N2UgPSBMLmNpcmNsZU1hcmtlcigKICAgICAgICAgICAgICAgIFs0My43NzA2MDIyNjE2LC03OS40MDE0ODM3ODk2MDAwMl0sCiAgICAgICAgICAgICAgICB7CiAgImJ1YmJsaW5nTW91c2VFdmVudHMiOiB0cnVlLAogICJjb2xvciI6ICIjNTRmZjAwIiwKICAiZGFzaEFycmF5IjogbnVsbCwKICAiZGFzaE9mZnNldCI6IG51bGwsCiAgImZpbGwiOiB0cnVlLAogICJmaWxsQ29sb3IiOiAiIzU0ZmYwMCIsCiAgImZpbGxPcGFjaXR5IjogMC45LAogICJmaWxsUnVsZSI6ICJldmVub2RkIiwKICAibGluZUNhcCI6ICJyb3VuZCIsCiAgImxpbmVKb2luIjogInJvdW5kIiwKICAib3BhY2l0eSI6IDEuMCwKICAicmFkaXVzIjogNSwKICAic3Ryb2tlIjogdHJ1ZSwKICAid2VpZ2h0IjogMwp9CiAgICAgICAgICAgICAgICApLmFkZFRvKG1hcF9jNmIxYTQ1Yzk5MTM0YzUyYWFmODU1ZmQ3YTVjM2YzYSk7CiAgICAgICAgICAgIAogICAgCiAgICAgICAgICAgIHZhciBwb3B1cF9jYWVhNzUxMzBlMmU0NjIzYTA2MzM0NTY3MmFjNDA4NCA9IEwucG9wdXAoe21heFdpZHRoOiAnMzAwJ30pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB2YXIgaHRtbF9jOTA1OThmZjc3MDk0MDMxYTJkZDc1ZmJjMGJiZmM2MSA9ICQoJzxkaXYgaWQ9Imh0bWxfYzkwNTk4ZmY3NzA5NDAzMWEyZGQ3NWZiYzBiYmZjNjEiIHN0eWxlPSJ3aWR0aDogMTAwLjAlOyBoZWlnaHQ6IDEwMC4wJTsiPldpbGxvd2RhbGUuRWFzdCB+fn4gQ2x1c3RlcjogMDwvZGl2PicpWzBdOwogICAgICAgICAgICAgICAgcG9wdXBfY2FlYTc1MTMwZTJlNDYyM2EwNjMzNDU2NzJhYzQwODQuc2V0Q29udGVudChodG1sX2M5MDU5OGZmNzcwOTQwMzFhMmRkNzVmYmMwYmJmYzYxKTsKICAgICAgICAgICAgCgogICAgICAgICAgICBjaXJjbGVfbWFya2VyXzA0N2U3NDk4ZDg5NjQ5Mzg4MGFkN2FiYzNiODkzNzdlLmJpbmRQb3B1cChwb3B1cF9jYWVhNzUxMzBlMmU0NjIzYTA2MzM0NTY3MmFjNDA4NCk7CgogICAgICAgICAgICAKICAgICAgICAKICAgIAogICAgICAgICAgICB2YXIgY2lyY2xlX21hcmtlcl8xOWNkMDhiNWQ5NjY0NjhmYWYyYWY0NGI5MmE4NTM0MCA9IEwuY2lyY2xlTWFya2VyKAogICAgICAgICAgICAgICAgWzQzLjYzMzQ2MzM0OTcsLTc5LjU0MzMxNjUzNTRdLAogICAgICAgICAgICAgICAgewogICJidWJibGluZ01vdXNlRXZlbnRzIjogdHJ1ZSwKICAiY29sb3IiOiAiIzU0ZmYwMCIsCiAgImRhc2hBcnJheSI6IG51bGwsCiAgImRhc2hPZmZzZXQiOiBudWxsLAogICJmaWxsIjogdHJ1ZSwKICAiZmlsbENvbG9yIjogIiM1NGZmMDAiLAogICJmaWxsT3BhY2l0eSI6IDAuOSwKICAiZmlsbFJ1bGUiOiAiZXZlbm9kZCIsCiAgImxpbmVDYXAiOiAicm91bmQiLAogICJsaW5lSm9pbiI6ICJyb3VuZCIsCiAgIm9wYWNpdHkiOiAxLjAsCiAgInJhZGl1cyI6IDUsCiAgInN0cm9rZSI6IHRydWUsCiAgIndlaWdodCI6IDMKfQogICAgICAgICAgICAgICAgKS5hZGRUbyhtYXBfYzZiMWE0NWM5OTEzNGM1MmFhZjg1NWZkN2E1YzNmM2EpOwogICAgICAgICAgICAKICAgIAogICAgICAgICAgICB2YXIgcG9wdXBfMzkwMmMxN2MzZmMyNGZmMTk5NjA5Nzk4NGVjOGY4OGMgPSBMLnBvcHVwKHttYXhXaWR0aDogJzMwMCd9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdmFyIGh0bWxfOGNkNjk2ZTQ4MThjNDIxMTgxZTYxZGY0ZTNiY2RiYmMgPSAkKCc8ZGl2IGlkPSJodG1sXzhjZDY5NmU0ODE4YzQyMTE4MWU2MWRmNGUzYmNkYmJjIiBzdHlsZT0id2lkdGg6IDEwMC4wJTsgaGVpZ2h0OiAxMDAuMCU7Ij5Jc2xpbmd0b24uQ2l0eS5DZW50cmUuV2VzdCB+fn4gQ2x1c3RlcjogMDwvZGl2PicpWzBdOwogICAgICAgICAgICAgICAgcG9wdXBfMzkwMmMxN2MzZmMyNGZmMTk5NjA5Nzk4NGVjOGY4OGMuc2V0Q29udGVudChodG1sXzhjZDY5NmU0ODE4YzQyMTE4MWU2MWRmNGUzYmNkYmJjKTsKICAgICAgICAgICAgCgogICAgICAgICAgICBjaXJjbGVfbWFya2VyXzE5Y2QwOGI1ZDk2NjQ2OGZhZjJhZjQ0YjkyYTg1MzQwLmJpbmRQb3B1cChwb3B1cF8zOTAyYzE3YzNmYzI0ZmYxOTk2MDk3OTg0ZWM4Zjg4Yyk7CgogICAgICAgICAgICAKICAgICAgICAKICAgIAogICAgICAgICAgICB2YXIgY2lyY2xlX21hcmtlcl9jODBmYjlkNWZkYzY0ZDBiYWEzN2EwZDE2M2FhM2E3ZSA9IEwuY2lyY2xlTWFya2VyKAogICAgICAgICAgICAgICAgWzQzLjc2Njc0MDIzOTMwMDAwNiwtNzkuMjI4NTg1NzY3MV0sCiAgICAgICAgICAgICAgICB7CiAgImJ1YmJsaW5nTW91c2VFdmVudHMiOiB0cnVlLAogICJjb2xvciI6ICIjNTRmZjAwIiwKICAiZGFzaEFycmF5IjogbnVsbCwKICAiZGFzaE9mZnNldCI6IG51bGwsCiAgImZpbGwiOiB0cnVlLAogICJmaWxsQ29sb3IiOiAiIzU0ZmYwMCIsCiAgImZpbGxPcGFjaXR5IjogMC45LAogICJmaWxsUnVsZSI6ICJldmVub2RkIiwKICAibGluZUNhcCI6ICJyb3VuZCIsCiAgImxpbmVKb2luIjogInJvdW5kIiwKICAib3BhY2l0eSI6IDEuMCwKICAicmFkaXVzIjogNSwKICAic3Ryb2tlIjogdHJ1ZSwKICAid2VpZ2h0IjogMwp9CiAgICAgICAgICAgICAgICApLmFkZFRvKG1hcF9jNmIxYTQ1Yzk5MTM0YzUyYWFmODU1ZmQ3YTVjM2YzYSk7CiAgICAgICAgICAgIAogICAgCiAgICAgICAgICAgIHZhciBwb3B1cF84ZjU0NjM0ZThhNWI0OTU3OTlkYWFkMTFmOWI0ZWRmNCA9IEwucG9wdXAoe21heFdpZHRoOiAnMzAwJ30pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB2YXIgaHRtbF81ZGRlMjhjMWNjZDE0MTJkODhjMTA1NzgwM2FkNWVjNCA9ICQoJzxkaXYgaWQ9Imh0bWxfNWRkZTI4YzFjY2QxNDEyZDg4YzEwNTc4MDNhZDVlYzQiIHN0eWxlPSJ3aWR0aDogMTAwLjAlOyBoZWlnaHQ6IDEwMC4wJTsiPldvYnVybiB+fn4gQ2x1c3RlcjogMDwvZGl2PicpWzBdOwogICAgICAgICAgICAgICAgcG9wdXBfOGY1NDYzNGU4YTViNDk1Nzk5ZGFhZDExZjliNGVkZjQuc2V0Q29udGVudChodG1sXzVkZGUyOGMxY2NkMTQxMmQ4OGMxMDU3ODAzYWQ1ZWM0KTsKICAgICAgICAgICAgCgogICAgICAgICAgICBjaXJjbGVfbWFya2VyX2M4MGZiOWQ1ZmRjNjRkMGJhYTM3YTBkMTYzYWEzYTdlLmJpbmRQb3B1cChwb3B1cF84ZjU0NjM0ZThhNWI0OTU3OTlkYWFkMTFmOWI0ZWRmNCk7CgogICAgICAgICAgICAKICAgICAgICAKICAgIAogICAgICAgICAgICB2YXIgY2lyY2xlX21hcmtlcl81MDQwMTZhNjM5OTI0YTU1YTU2OWZmMDRjMzdmZDhmZiA9IEwuY2lyY2xlTWFya2VyKAogICAgICAgICAgICAgICAgWzQzLjgyMTIwMTI1NjksLTc5LjE4NjM0MzQ0NThdLAogICAgICAgICAgICAgICAgewogICJidWJibGluZ01vdXNlRXZlbnRzIjogdHJ1ZSwKICAiY29sb3IiOiAiIzU0ZmYwMCIsCiAgImRhc2hBcnJheSI6IG51bGwsCiAgImRhc2hPZmZzZXQiOiBudWxsLAogICJmaWxsIjogdHJ1ZSwKICAiZmlsbENvbG9yIjogIiM1NGZmMDAiLAogICJmaWxsT3BhY2l0eSI6IDAuOSwKICAiZmlsbFJ1bGUiOiAiZXZlbm9kZCIsCiAgImxpbmVDYXAiOiAicm91bmQiLAogICJsaW5lSm9pbiI6ICJyb3VuZCIsCiAgIm9wYWNpdHkiOiAxLjAsCiAgInJhZGl1cyI6IDUsCiAgInN0cm9rZSI6IHRydWUsCiAgIndlaWdodCI6IDMKfQogICAgICAgICAgICAgICAgKS5hZGRUbyhtYXBfYzZiMWE0NWM5OTEzNGM1MmFhZjg1NWZkN2E1YzNmM2EpOwogICAgICAgICAgICAKICAgIAogICAgICAgICAgICB2YXIgcG9wdXBfNmIzNDQ0OWI4Y2ZjNGFkNGE0Njk2MGVjMzBhODE3Y2EgPSBMLnBvcHVwKHttYXhXaWR0aDogJzMwMCd9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdmFyIGh0bWxfNWVkNmQ3ODIzYTZiNDM1MGFiYzc2MDQ4NGFiZTg4NmQgPSAkKCc8ZGl2IGlkPSJodG1sXzVlZDZkNzgyM2E2YjQzNTBhYmM3NjA0ODRhYmU4ODZkIiBzdHlsZT0id2lkdGg6IDEwMC4wJTsgaGVpZ2h0OiAxMDAuMCU7Ij5Sb3VnZSB+fn4gQ2x1c3RlcjogMDwvZGl2PicpWzBdOwogICAgICAgICAgICAgICAgcG9wdXBfNmIzNDQ0OWI4Y2ZjNGFkNGE0Njk2MGVjMzBhODE3Y2Euc2V0Q29udGVudChodG1sXzVlZDZkNzgyM2E2YjQzNTBhYmM3NjA0ODRhYmU4ODZkKTsKICAgICAgICAgICAgCgogICAgICAgICAgICBjaXJjbGVfbWFya2VyXzUwNDAxNmE2Mzk5MjRhNTVhNTY5ZmYwNGMzN2ZkOGZmLmJpbmRQb3B1cChwb3B1cF82YjM0NDQ5YjhjZmM0YWQ0YTQ2OTYwZWMzMGE4MTdjYSk7CgogICAgICAgICAgICAKICAgICAgICAKICAgIAogICAgICAgICAgICB2YXIgY2lyY2xlX21hcmtlcl84ZTBjNGQ4YjZkY2Q0ZmU1YmEyNWZiZTg1OGE0NTk4YiA9IEwuY2lyY2xlTWFya2VyKAogICAgICAgICAgICAgICAgWzQzLjY2NTY3NjkzMTcsLTc5LjQzODU0MDY5ODZdLAogICAgICAgICAgICAgICAgewogICJidWJibGluZ01vdXNlRXZlbnRzIjogdHJ1ZSwKICAiY29sb3IiOiAiIzU0ZmYwMCIsCiAgImRhc2hBcnJheSI6IG51bGwsCiAgImRhc2hPZmZzZXQiOiBudWxsLAogICJmaWxsIjogdHJ1ZSwKICAiZmlsbENvbG9yIjogIiM1NGZmMDAiLAogICJmaWxsT3BhY2l0eSI6IDAuOSwKICAiZmlsbFJ1bGUiOiAiZXZlbm9kZCIsCiAgImxpbmVDYXAiOiAicm91bmQiLAogICJsaW5lSm9pbiI6ICJyb3VuZCIsCiAgIm9wYWNpdHkiOiAxLjAsCiAgInJhZGl1cyI6IDUsCiAgInN0cm9rZSI6IHRydWUsCiAgIndlaWdodCI6IDMKfQogICAgICAgICAgICAgICAgKS5hZGRUbyhtYXBfYzZiMWE0NWM5OTEzNGM1MmFhZjg1NWZkN2E1YzNmM2EpOwogICAgICAgICAgICAKICAgIAogICAgICAgICAgICB2YXIgcG9wdXBfMTk4MjcwNjcxYWY5NDlkNTkyMWUyMmJkZmM0YzE5MGIgPSBMLnBvcHVwKHttYXhXaWR0aDogJzMwMCd9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdmFyIGh0bWxfZjgyNDg3OTE3Y2Y4NDBlYjkyOTMzZWQ5MGZkZDllZTIgPSAkKCc8ZGl2IGlkPSJodG1sX2Y4MjQ4NzkxN2NmODQwZWI5MjkzM2VkOTBmZGQ5ZWUyIiBzdHlsZT0id2lkdGg6IDEwMC4wJTsgaGVpZ2h0OiAxMDAuMCU7Ij5Eb3ZlcmNvdXJ0LldhbGxhY2UuRW1lcnNvbi5KdW5jdGlvbiB+fn4gQ2x1c3RlcjogMDwvZGl2PicpWzBdOwogICAgICAgICAgICAgICAgcG9wdXBfMTk4MjcwNjcxYWY5NDlkNTkyMWUyMmJkZmM0YzE5MGIuc2V0Q29udGVudChodG1sX2Y4MjQ4NzkxN2NmODQwZWI5MjkzM2VkOTBmZGQ5ZWUyKTsKICAgICAgICAgICAgCgogICAgICAgICAgICBjaXJjbGVfbWFya2VyXzhlMGM0ZDhiNmRjZDRmZTViYTI1ZmJlODU4YTQ1OThiLmJpbmRQb3B1cChwb3B1cF8xOTgyNzA2NzFhZjk0OWQ1OTIxZTIyYmRmYzRjMTkwYik7CgogICAgICAgICAgICAKICAgICAgICAKICAgIAogICAgICAgICAgICB2YXIgY2lyY2xlX21hcmtlcl8zOGE0ZTk4ODVmNGM0NmMzOGUzYjg3YmY3MTRiODUzZCA9IEwuY2lyY2xlTWFya2VyKAogICAgICAgICAgICAgICAgWzQzLjY1OTY0ODg2MzUsLTc5LjM3OTAxNzE2NjZdLAogICAgICAgICAgICAgICAgewogICJidWJibGluZ01vdXNlRXZlbnRzIjogdHJ1ZSwKICAiY29sb3IiOiAiIzU0ZmYwMCIsCiAgImRhc2hBcnJheSI6IG51bGwsCiAgImRhc2hPZmZzZXQiOiBudWxsLAogICJmaWxsIjogdHJ1ZSwKICAiZmlsbENvbG9yIjogIiM1NGZmMDAiLAogICJmaWxsT3BhY2l0eSI6IDAuOSwKICAiZmlsbFJ1bGUiOiAiZXZlbm9kZCIsCiAgImxpbmVDYXAiOiAicm91bmQiLAogICJsaW5lSm9pbiI6ICJyb3VuZCIsCiAgIm9wYWNpdHkiOiAxLjAsCiAgInJhZGl1cyI6IDUsCiAgInN0cm9rZSI6IHRydWUsCiAgIndlaWdodCI6IDMKfQogICAgICAgICAgICAgICAgKS5hZGRUbyhtYXBfYzZiMWE0NWM5OTEzNGM1MmFhZjg1NWZkN2E1YzNmM2EpOwogICAgICAgICAgICAKICAgIAogICAgICAgICAgICB2YXIgcG9wdXBfZjIyOTlmZTI5MTE0NGQxMDhhNjg0NWUxMzE1MTk5N2YgPSBMLnBvcHVwKHttYXhXaWR0aDogJzMwMCd9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdmFyIGh0bWxfMmMxMTAxMmZkMmFjNDBiNjllMDg3MDUxNjE3NTQyZTAgPSAkKCc8ZGl2IGlkPSJodG1sXzJjMTEwMTJmZDJhYzQwYjY5ZTA4NzA1MTYxNzU0MmUwIiBzdHlsZT0id2lkdGg6IDEwMC4wJTsgaGVpZ2h0OiAxMDAuMCU7Ij5DaHVyY2guWW9uZ2UuQ29ycmlkb3Igfn5+IENsdXN0ZXI6IDA8L2Rpdj4nKVswXTsKICAgICAgICAgICAgICAgIHBvcHVwX2YyMjk5ZmUyOTExNDRkMTA4YTY4NDVlMTMxNTE5OTdmLnNldENvbnRlbnQoaHRtbF8yYzExMDEyZmQyYWM0MGI2OWUwODcwNTE2MTc1NDJlMCk7CiAgICAgICAgICAgIAoKICAgICAgICAgICAgY2lyY2xlX21hcmtlcl8zOGE0ZTk4ODVmNGM0NmMzOGUzYjg3YmY3MTRiODUzZC5iaW5kUG9wdXAocG9wdXBfZjIyOTlmZTI5MTE0NGQxMDhhNjg0NWUxMzE1MTk5N2YpOwoKICAgICAgICAgICAgCiAgICAgICAgCiAgICAKICAgICAgICAgICAgdmFyIGNpcmNsZV9tYXJrZXJfYzFmMmZkYjkwN2NmNDQxOGEwZjlhNjJmMjhlNGNmNDMgPSBMLmNpcmNsZU1hcmtlcigKICAgICAgICAgICAgICAgIFs0My42NzE1ODU0MzUxLC03OS40MDQwMDA2MjQzXSwKICAgICAgICAgICAgICAgIHsKICAiYnViYmxpbmdNb3VzZUV2ZW50cyI6IHRydWUsCiAgImNvbG9yIjogIiM1NGZmMDAiLAogICJkYXNoQXJyYXkiOiBudWxsLAogICJkYXNoT2Zmc2V0IjogbnVsbCwKICAiZmlsbCI6IHRydWUsCiAgImZpbGxDb2xvciI6ICIjNTRmZjAwIiwKICAiZmlsbE9wYWNpdHkiOiAwLjksCiAgImZpbGxSdWxlIjogImV2ZW5vZGQiLAogICJsaW5lQ2FwIjogInJvdW5kIiwKICAibGluZUpvaW4iOiAicm91bmQiLAogICJvcGFjaXR5IjogMS4wLAogICJyYWRpdXMiOiA1LAogICJzdHJva2UiOiB0cnVlLAogICJ3ZWlnaHQiOiAzCn0KICAgICAgICAgICAgICAgICkuYWRkVG8obWFwX2M2YjFhNDVjOTkxMzRjNTJhYWY4NTVmZDdhNWMzZjNhKTsKICAgICAgICAgICAgCiAgICAKICAgICAgICAgICAgdmFyIHBvcHVwXzZjNDJiNmQzYWU2NjQ5MDVhNTM3ZTA3MDhjOGUxNWI2ID0gTC5wb3B1cCh7bWF4V2lkdGg6ICczMDAnfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIHZhciBodG1sXzQwYTM3M2Q2NWMyNjQxMWNiOGY2Y2Y2ZGEwNTgwNzE0ID0gJCgnPGRpdiBpZD0iaHRtbF80MGEzNzNkNjVjMjY0MTFjYjhmNmNmNmRhMDU4MDcxNCIgc3R5bGU9IndpZHRoOiAxMDAuMCU7IGhlaWdodDogMTAwLjAlOyI+QW5uZXggfn5+IENsdXN0ZXI6IDA8L2Rpdj4nKVswXTsKICAgICAgICAgICAgICAgIHBvcHVwXzZjNDJiNmQzYWU2NjQ5MDVhNTM3ZTA3MDhjOGUxNWI2LnNldENvbnRlbnQoaHRtbF80MGEzNzNkNjVjMjY0MTFjYjhmNmNmNmRhMDU4MDcxNCk7CiAgICAgICAgICAgIAoKICAgICAgICAgICAgY2lyY2xlX21hcmtlcl9jMWYyZmRiOTA3Y2Y0NDE4YTBmOWE2MmYyOGU0Y2Y0My5iaW5kUG9wdXAocG9wdXBfNmM0MmI2ZDNhZTY2NDkwNWE1MzdlMDcwOGM4ZTE1YjYpOwoKICAgICAgICAgICAgCiAgICAgICAgCiAgICAKICAgICAgICAgICAgdmFyIGNpcmNsZV9tYXJrZXJfY2ExMGE5Yzg3N2Q5NDU3NjgwNjBmMDQ4ZDZjYTlkN2MgPSBMLmNpcmNsZU1hcmtlcigKICAgICAgICAgICAgICAgIFs0My42MTU5MjM4NjEzMDAwMDQsLTc5LjUwMDEzNjYzNjRdLAogICAgICAgICAgICAgICAgewogICJidWJibGluZ01vdXNlRXZlbnRzIjogdHJ1ZSwKICAiY29sb3IiOiAiIzU0ZmYwMCIsCiAgImRhc2hBcnJheSI6IG51bGwsCiAgImRhc2hPZmZzZXQiOiBudWxsLAogICJmaWxsIjogdHJ1ZSwKICAiZmlsbENvbG9yIjogIiM1NGZmMDAiLAogICJmaWxsT3BhY2l0eSI6IDAuOSwKICAiZmlsbFJ1bGUiOiAiZXZlbm9kZCIsCiAgImxpbmVDYXAiOiAicm91bmQiLAogICJsaW5lSm9pbiI6ICJyb3VuZCIsCiAgIm9wYWNpdHkiOiAxLjAsCiAgInJhZGl1cyI6IDUsCiAgInN0cm9rZSI6IHRydWUsCiAgIndlaWdodCI6IDMKfQogICAgICAgICAgICAgICAgKS5hZGRUbyhtYXBfYzZiMWE0NWM5OTEzNGM1MmFhZjg1NWZkN2E1YzNmM2EpOwogICAgICAgICAgICAKICAgIAogICAgICAgICAgICB2YXIgcG9wdXBfNWM0ZTFjNzI2MGUzNDI3YmI4ODQ5ODA4MmYwYmZiNzYgPSBMLnBvcHVwKHttYXhXaWR0aDogJzMwMCd9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdmFyIGh0bWxfYTJiZWQ3MjIwZWRiNDg5YjgzMjcwNTc1ODA1ZTI3MjUgPSAkKCc8ZGl2IGlkPSJodG1sX2EyYmVkNzIyMGVkYjQ4OWI4MzI3MDU3NTgwNWUyNzI1IiBzdHlsZT0id2lkdGg6IDEwMC4wJTsgaGVpZ2h0OiAxMDAuMCU7Ij5NaW1pY28uLmluY2x1ZGVzLkh1bWJlci5CYXkuU2hvcmVzLiB+fn4gQ2x1c3RlcjogMDwvZGl2PicpWzBdOwogICAgICAgICAgICAgICAgcG9wdXBfNWM0ZTFjNzI2MGUzNDI3YmI4ODQ5ODA4MmYwYmZiNzYuc2V0Q29udGVudChodG1sX2EyYmVkNzIyMGVkYjQ4OWI4MzI3MDU3NTgwNWUyNzI1KTsKICAgICAgICAgICAgCgogICAgICAgICAgICBjaXJjbGVfbWFya2VyX2NhMTBhOWM4NzdkOTQ1NzY4MDYwZjA0OGQ2Y2E5ZDdjLmJpbmRQb3B1cChwb3B1cF81YzRlMWM3MjYwZTM0MjdiYjg4NDk4MDgyZjBiZmI3Nik7CgogICAgICAgICAgICAKICAgICAgICAKICAgIAogICAgICAgICAgICB2YXIgY2lyY2xlX21hcmtlcl80NjBkY2NiZGYwMzA0NGQxOWE5NTk3OTg0YTczOWRlNSA9IEwuY2lyY2xlTWFya2VyKAogICAgICAgICAgICAgICAgWzQzLjcwNDQzNTE3MDYwMDAxLC03OS4zOTMzNTk1NTRdLAogICAgICAgICAgICAgICAgewogICJidWJibGluZ01vdXNlRXZlbnRzIjogdHJ1ZSwKICAiY29sb3IiOiAiIzU0ZmYwMCIsCiAgImRhc2hBcnJheSI6IG51bGwsCiAgImRhc2hPZmZzZXQiOiBudWxsLAogICJmaWxsIjogdHJ1ZSwKICAiZmlsbENvbG9yIjogIiM1NGZmMDAiLAogICJmaWxsT3BhY2l0eSI6IDAuOSwKICAiZmlsbFJ1bGUiOiAiZXZlbm9kZCIsCiAgImxpbmVDYXAiOiAicm91bmQiLAogICJsaW5lSm9pbiI6ICJyb3VuZCIsCiAgIm9wYWNpdHkiOiAxLjAsCiAgInJhZGl1cyI6IDUsCiAgInN0cm9rZSI6IHRydWUsCiAgIndlaWdodCI6IDMKfQogICAgICAgICAgICAgICAgKS5hZGRUbyhtYXBfYzZiMWE0NWM5OTEzNGM1MmFhZjg1NWZkN2E1YzNmM2EpOwogICAgICAgICAgICAKICAgIAogICAgICAgICAgICB2YXIgcG9wdXBfNTM3NTk1MmJiOWZjNGVmODg0ZmQ0OGU5Zjc0MWIyYzcgPSBMLnBvcHVwKHttYXhXaWR0aDogJzMwMCd9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdmFyIGh0bWxfYjZmMzJmNDVmMWM5NDJhMmE1MTBhMTM4NzNmM2U2OTkgPSAkKCc8ZGl2IGlkPSJodG1sX2I2ZjMyZjQ1ZjFjOTQyYTJhNTEwYTEzODczZjNlNjk5IiBzdHlsZT0id2lkdGg6IDEwMC4wJTsgaGVpZ2h0OiAxMDAuMCU7Ij5Nb3VudC5QbGVhc2FudC5XZXN0IH5+fiBDbHVzdGVyOiAwPC9kaXY+JylbMF07CiAgICAgICAgICAgICAgICBwb3B1cF81Mzc1OTUyYmI5ZmM0ZWY4ODRmZDQ4ZTlmNzQxYjJjNy5zZXRDb250ZW50KGh0bWxfYjZmMzJmNDVmMWM5NDJhMmE1MTBhMTM4NzNmM2U2OTkpOwogICAgICAgICAgICAKCiAgICAgICAgICAgIGNpcmNsZV9tYXJrZXJfNDYwZGNjYmRmMDMwNDRkMTlhOTU5Nzk4NGE3MzlkZTUuYmluZFBvcHVwKHBvcHVwXzUzNzU5NTJiYjlmYzRlZjg4NGZkNDhlOWY3NDFiMmM3KTsKCiAgICAgICAgICAgIAogICAgICAgIAogICAgCiAgICAgICAgICAgIHZhciBjaXJjbGVfbWFya2VyXzRiNmEyYTRiZmVhMjRlNGI4MzViMzgxN2U4YTAzZjhjID0gTC5jaXJjbGVNYXJrZXIoCiAgICAgICAgICAgICAgICBbNDMuODAzNjU4MTk2NywtNzkuMjIyNTE2NjE4OTk5OTldLAogICAgICAgICAgICAgICAgewogICJidWJibGluZ01vdXNlRXZlbnRzIjogdHJ1ZSwKICAiY29sb3IiOiAiI2ZmZDcwMCIsCiAgImRhc2hBcnJheSI6IG51bGwsCiAgImRhc2hPZmZzZXQiOiBudWxsLAogICJmaWxsIjogdHJ1ZSwKICAiZmlsbENvbG9yIjogIiNmZmQ3MDAiLAogICJmaWxsT3BhY2l0eSI6IDAuOSwKICAiZmlsbFJ1bGUiOiAiZXZlbm9kZCIsCiAgImxpbmVDYXAiOiAicm91bmQiLAogICJsaW5lSm9pbiI6ICJyb3VuZCIsCiAgIm9wYWNpdHkiOiAxLjAsCiAgInJhZGl1cyI6IDUsCiAgInN0cm9rZSI6IHRydWUsCiAgIndlaWdodCI6IDMKfQogICAgICAgICAgICAgICAgKS5hZGRUbyhtYXBfYzZiMWE0NWM5OTEzNGM1MmFhZjg1NWZkN2E1YzNmM2EpOwogICAgICAgICAgICAKICAgIAogICAgICAgICAgICB2YXIgcG9wdXBfMzNmNmFhY2UyODFjNDM2MGI0NzM4ZDliYjc1MmE0ZmIgPSBMLnBvcHVwKHttYXhXaWR0aDogJzMwMCd9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdmFyIGh0bWxfYmEzMGRjMjI2ODE2NDBhZTg4NzljOTM1MzBiYmZkZmIgPSAkKCc8ZGl2IGlkPSJodG1sX2JhMzBkYzIyNjgxNjQwYWU4ODc5YzkzNTMwYmJmZGZiIiBzdHlsZT0id2lkdGg6IDEwMC4wJTsgaGVpZ2h0OiAxMDAuMCU7Ij5NYWx2ZXJuIH5+fiBDbHVzdGVyOiAyPC9kaXY+JylbMF07CiAgICAgICAgICAgICAgICBwb3B1cF8zM2Y2YWFjZTI4MWM0MzYwYjQ3MzhkOWJiNzUyYTRmYi5zZXRDb250ZW50KGh0bWxfYmEzMGRjMjI2ODE2NDBhZTg4NzljOTM1MzBiYmZkZmIpOwogICAgICAgICAgICAKCiAgICAgICAgICAgIGNpcmNsZV9tYXJrZXJfNGI2YTJhNGJmZWEyNGU0YjgzNWIzODE3ZThhMDNmOGMuYmluZFBvcHVwKHBvcHVwXzMzZjZhYWNlMjgxYzQzNjBiNDczOGQ5YmI3NTJhNGZiKTsKCiAgICAgICAgICAgIAogICAgICAgIAogICAgCiAgICAgICAgICAgIHZhciBjaXJjbGVfbWFya2VyXzQ4MzE0YjNhOWQ4NjQ0NGRhZmE3NmEzMGI3ZWE0ODZlID0gTC5jaXJjbGVNYXJrZXIoCiAgICAgICAgICAgICAgICBbNDMuNjU3NDIwMTMwNCwtNzkuNDk2MDQ1MjU1M10sCiAgICAgICAgICAgICAgICB7CiAgImJ1YmJsaW5nTW91c2VFdmVudHMiOiB0cnVlLAogICJjb2xvciI6ICIjZmZkNzAwIiwKICAiZGFzaEFycmF5IjogbnVsbCwKICAiZGFzaE9mZnNldCI6IG51bGwsCiAgImZpbGwiOiB0cnVlLAogICJmaWxsQ29sb3IiOiAiI2ZmZDcwMCIsCiAgImZpbGxPcGFjaXR5IjogMC45LAogICJmaWxsUnVsZSI6ICJldmVub2RkIiwKICAibGluZUNhcCI6ICJyb3VuZCIsCiAgImxpbmVKb2luIjogInJvdW5kIiwKICAib3BhY2l0eSI6IDEuMCwKICAicmFkaXVzIjogNSwKICAic3Ryb2tlIjogdHJ1ZSwKICAid2VpZ2h0IjogMwp9CiAgICAgICAgICAgICAgICApLmFkZFRvKG1hcF9jNmIxYTQ1Yzk5MTM0YzUyYWFmODU1ZmQ3YTVjM2YzYSk7CiAgICAgICAgICAgIAogICAgCiAgICAgICAgICAgIHZhciBwb3B1cF9iZTM2MTYwZmU5NTE0NDU5OWY0ZDQ5ZTY1OGI4ZThhYyA9IEwucG9wdXAoe21heFdpZHRoOiAnMzAwJ30pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB2YXIgaHRtbF9mYzJlZTgwMWVkOTc0YTZlYjY5NDFlYmQyYjY3OTU3MSA9ICQoJzxkaXYgaWQ9Imh0bWxfZmMyZWU4MDFlZDk3NGE2ZWI2OTQxZWJkMmI2Nzk1NzEiIHN0eWxlPSJ3aWR0aDogMTAwLjAlOyBoZWlnaHQ6IDEwMC4wJTsiPkwuQW1vcmVhdXggfn5+IENsdXN0ZXI6IDI8L2Rpdj4nKVswXTsKICAgICAgICAgICAgICAgIHBvcHVwX2JlMzYxNjBmZTk1MTQ0NTk5ZjRkNDllNjU4YjhlOGFjLnNldENvbnRlbnQoaHRtbF9mYzJlZTgwMWVkOTc0YTZlYjY5NDFlYmQyYjY3OTU3MSk7CiAgICAgICAgICAgIAoKICAgICAgICAgICAgY2lyY2xlX21hcmtlcl80ODMxNGIzYTlkODY0NDRkYWZhNzZhMzBiN2VhNDg2ZS5iaW5kUG9wdXAocG9wdXBfYmUzNjE2MGZlOTUxNDQ1OTlmNGQ0OWU2NThiOGU4YWMpOwoKICAgICAgICAgICAgCiAgICAgICAgCiAgICAKICAgICAgICAgICAgdmFyIGNpcmNsZV9tYXJrZXJfNDljY2U2YTRkZTA2NDY3NTlhMDgyMWQwMTU0Y2M3MTYgPSBMLmNpcmNsZU1hcmtlcigKICAgICAgICAgICAgICAgIFs0My42NDkyOTIwNjM1MDAwMDYsLTc5LjMzNTY1MTMyMV0sCiAgICAgICAgICAgICAgICB7CiAgImJ1YmJsaW5nTW91c2VFdmVudHMiOiB0cnVlLAogICJjb2xvciI6ICIjZmZkNzAwIiwKICAiZGFzaEFycmF5IjogbnVsbCwKICAiZGFzaE9mZnNldCI6IG51bGwsCiAgImZpbGwiOiB0cnVlLAogICJmaWxsQ29sb3IiOiAiI2ZmZDcwMCIsCiAgImZpbGxPcGFjaXR5IjogMC45LAogICJmaWxsUnVsZSI6ICJldmVub2RkIiwKICAibGluZUNhcCI6ICJyb3VuZCIsCiAgImxpbmVKb2luIjogInJvdW5kIiwKICAib3BhY2l0eSI6IDEuMCwKICAicmFkaXVzIjogNSwKICAic3Ryb2tlIjogdHJ1ZSwKICAid2VpZ2h0IjogMwp9CiAgICAgICAgICAgICAgICApLmFkZFRvKG1hcF9jNmIxYTQ1Yzk5MTM0YzUyYWFmODU1ZmQ3YTVjM2YzYSk7CiAgICAgICAgICAgIAogICAgCiAgICAgICAgICAgIHZhciBwb3B1cF8zMDIyOTU4MDgxZWM0Zjc2ODg1NDNmNGVhZThlMDA2YyA9IEwucG9wdXAoe21heFdpZHRoOiAnMzAwJ30pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB2YXIgaHRtbF84MjczYTMwMmY1MGU0NjM3YWNjZGNkNTk3YWRkYjg5MyA9ICQoJzxkaXYgaWQ9Imh0bWxfODI3M2EzMDJmNTBlNDYzN2FjY2RjZDU5N2FkZGI4OTMiIHN0eWxlPSJ3aWR0aDogMTAwLjAlOyBoZWlnaHQ6IDEwMC4wJTsiPlNvdXRoLlJpdmVyZGFsZSB+fn4gQ2x1c3RlcjogMjwvZGl2PicpWzBdOwogICAgICAgICAgICAgICAgcG9wdXBfMzAyMjk1ODA4MWVjNGY3Njg4NTQzZjRlYWU4ZTAwNmMuc2V0Q29udGVudChodG1sXzgyNzNhMzAyZjUwZTQ2MzdhY2NkY2Q1OTdhZGRiODkzKTsKICAgICAgICAgICAgCgogICAgICAgICAgICBjaXJjbGVfbWFya2VyXzQ5Y2NlNmE0ZGUwNjQ2NzU5YTA4MjFkMDE1NGNjNzE2LmJpbmRQb3B1cChwb3B1cF8zMDIyOTU4MDgxZWM0Zjc2ODg1NDNmNGVhZThlMDA2Yyk7CgogICAgICAgICAgICAKICAgICAgICAKICAgIAogICAgICAgICAgICB2YXIgY2lyY2xlX21hcmtlcl80YWUxZTQwMWI5MWE0YmFjYjdhYjllMTAzNjA5OTYyOSA9IEwuY2lyY2xlTWFya2VyKAogICAgICAgICAgICAgICAgWzQzLjY4MjgyMDQyNTI5OTk5NCwtNzkuMzc5NjY5NDAyNV0sCiAgICAgICAgICAgICAgICB7CiAgImJ1YmJsaW5nTW91c2VFdmVudHMiOiB0cnVlLAogICJjb2xvciI6ICIjZmZkNzAwIiwKICAiZGFzaEFycmF5IjogbnVsbCwKICAiZGFzaE9mZnNldCI6IG51bGwsCiAgImZpbGwiOiB0cnVlLAogICJmaWxsQ29sb3IiOiAiI2ZmZDcwMCIsCiAgImZpbGxPcGFjaXR5IjogMC45LAogICJmaWxsUnVsZSI6ICJldmVub2RkIiwKICAibGluZUNhcCI6ICJyb3VuZCIsCiAgImxpbmVKb2luIjogInJvdW5kIiwKICAib3BhY2l0eSI6IDEuMCwKICAicmFkaXVzIjogNSwKICAic3Ryb2tlIjogdHJ1ZSwKICAid2VpZ2h0IjogMwp9CiAgICAgICAgICAgICAgICApLmFkZFRvKG1hcF9jNmIxYTQ1Yzk5MTM0YzUyYWFmODU1ZmQ3YTVjM2YzYSk7CiAgICAgICAgICAgIAogICAgCiAgICAgICAgICAgIHZhciBwb3B1cF9hYmJmZDZkNWNjNTA0OWFjODEyYjcyMDVlYTgxODY4NSA9IEwucG9wdXAoe21heFdpZHRoOiAnMzAwJ30pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB2YXIgaHRtbF8wZjQ2ZWQ5NzIzM2M0YTZiYTBhN2Y2ZDZkZGMyZWEyYiA9ICQoJzxkaXYgaWQ9Imh0bWxfMGY0NmVkOTcyMzNjNGE2YmEwYTdmNmQ2ZGRjMmVhMmIiIHN0eWxlPSJ3aWR0aDogMTAwLjAlOyBoZWlnaHQ6IDEwMC4wJTsiPlJvc2VkYWxlLk1vb3JlLlBhcmsgfn5+IENsdXN0ZXI6IDI8L2Rpdj4nKVswXTsKICAgICAgICAgICAgICAgIHBvcHVwX2FiYmZkNmQ1Y2M1MDQ5YWM4MTJiNzIwNWVhODE4Njg1LnNldENvbnRlbnQoaHRtbF8wZjQ2ZWQ5NzIzM2M0YTZiYTBhN2Y2ZDZkZGMyZWEyYik7CiAgICAgICAgICAgIAoKICAgICAgICAgICAgY2lyY2xlX21hcmtlcl80YWUxZTQwMWI5MWE0YmFjYjdhYjllMTAzNjA5OTYyOS5iaW5kUG9wdXAocG9wdXBfYWJiZmQ2ZDVjYzUwNDlhYzgxMmI3MjA1ZWE4MTg2ODUpOwoKICAgICAgICAgICAgCiAgICAgICAgCiAgICAKICAgICAgICAgICAgdmFyIGNpcmNsZV9tYXJrZXJfZGFhMTljZTZkYWVlNDQ3ZDg2ZDE4Y2U3MGI4ZDFkOTEgPSBMLmNpcmNsZU1hcmtlcigKICAgICAgICAgICAgICAgIFs0My42NDUwNjQ1ODM0LC03OS40Njc4NzIyMjQzMDAwMV0sCiAgICAgICAgICAgICAgICB7CiAgImJ1YmJsaW5nTW91c2VFdmVudHMiOiB0cnVlLAogICJjb2xvciI6ICIjZmZkNzAwIiwKICAiZGFzaEFycmF5IjogbnVsbCwKICAiZGFzaE9mZnNldCI6IG51bGwsCiAgImZpbGwiOiB0cnVlLAogICJmaWxsQ29sb3IiOiAiI2ZmZDcwMCIsCiAgImZpbGxPcGFjaXR5IjogMC45LAogICJmaWxsUnVsZSI6ICJldmVub2RkIiwKICAibGluZUNhcCI6ICJyb3VuZCIsCiAgImxpbmVKb2luIjogInJvdW5kIiwKICAib3BhY2l0eSI6IDEuMCwKICAicmFkaXVzIjogNSwKICAic3Ryb2tlIjogdHJ1ZSwKICAid2VpZ2h0IjogMwp9CiAgICAgICAgICAgICAgICApLmFkZFRvKG1hcF9jNmIxYTQ1Yzk5MTM0YzUyYWFmODU1ZmQ3YTVjM2YzYSk7CiAgICAgICAgICAgIAogICAgCiAgICAgICAgICAgIHZhciBwb3B1cF83NTg0ODc4ODRhYTU0NTE4YjBlZjAwM2MyNTc4MjU1MyA9IEwucG9wdXAoe21heFdpZHRoOiAnMzAwJ30pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB2YXIgaHRtbF81MzRlNmUxMjU5Y2Y0MzZiOTNjODEwN2MzYTA0N2QxNyA9ICQoJzxkaXYgaWQ9Imh0bWxfNTM0ZTZlMTI1OWNmNDM2YjkzYzgxMDdjM2EwNDdkMTciIHN0eWxlPSJ3aWR0aDogMTAwLjAlOyBoZWlnaHQ6IDEwMC4wJTsiPkhpZ2guUGFyay5Td2Fuc2VhIH5+fiBDbHVzdGVyOiAyPC9kaXY+JylbMF07CiAgICAgICAgICAgICAgICBwb3B1cF83NTg0ODc4ODRhYTU0NTE4YjBlZjAwM2MyNTc4MjU1My5zZXRDb250ZW50KGh0bWxfNTM0ZTZlMTI1OWNmNDM2YjkzYzgxMDdjM2EwNDdkMTcpOwogICAgICAgICAgICAKCiAgICAgICAgICAgIGNpcmNsZV9tYXJrZXJfZGFhMTljZTZkYWVlNDQ3ZDg2ZDE4Y2U3MGI4ZDFkOTEuYmluZFBvcHVwKHBvcHVwXzc1ODQ4Nzg4NGFhNTQ1MThiMGVmMDAzYzI1NzgyNTUzKTsKCiAgICAgICAgICAgIAogICAgICAgIAogICAgCiAgICAgICAgICAgIHZhciBjaXJjbGVfbWFya2VyXzFlZWVhY2E0YmYxMTQ0YTU4NGEwZWE1ZDc4MTQ5OWQ2ID0gTC5jaXJjbGVNYXJrZXIoCiAgICAgICAgICAgICAgICBbNDMuNzU1MDMzNDc0NDk5OTk2LC03OS4zMzAxNzk1MTcxXSwKICAgICAgICAgICAgICAgIHsKICAiYnViYmxpbmdNb3VzZUV2ZW50cyI6IHRydWUsCiAgImNvbG9yIjogIiNmZmQ3MDAiLAogICJkYXNoQXJyYXkiOiBudWxsLAogICJkYXNoT2Zmc2V0IjogbnVsbCwKICAiZmlsbCI6IHRydWUsCiAgImZpbGxDb2xvciI6ICIjZmZkNzAwIiwKICAiZmlsbE9wYWNpdHkiOiAwLjksCiAgImZpbGxSdWxlIjogImV2ZW5vZGQiLAogICJsaW5lQ2FwIjogInJvdW5kIiwKICAibGluZUpvaW4iOiAicm91bmQiLAogICJvcGFjaXR5IjogMS4wLAogICJyYWRpdXMiOiA1LAogICJzdHJva2UiOiB0cnVlLAogICJ3ZWlnaHQiOiAzCn0KICAgICAgICAgICAgICAgICkuYWRkVG8obWFwX2M2YjFhNDVjOTkxMzRjNTJhYWY4NTVmZDdhNWMzZjNhKTsKICAgICAgICAgICAgCiAgICAKICAgICAgICAgICAgdmFyIHBvcHVwXzI3Yjc2ODlhYThjNzQ1ODRhNjEwNTQ0NWIyYmUxMGEyID0gTC5wb3B1cCh7bWF4V2lkdGg6ICczMDAnfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIHZhciBodG1sXzkwNTRlOWY2ZGVjYTRiZTM5Yzg2NzZmMjIyZmE0MGM2ID0gJCgnPGRpdiBpZD0iaHRtbF85MDU0ZTlmNmRlY2E0YmUzOWM4Njc2ZjIyMmZhNDBjNiIgc3R5bGU9IndpZHRoOiAxMDAuMCU7IGhlaWdodDogMTAwLjAlOyI+UGFya3dvb2RzLkRvbmFsZGEgfn5+IENsdXN0ZXI6IDI8L2Rpdj4nKVswXTsKICAgICAgICAgICAgICAgIHBvcHVwXzI3Yjc2ODlhYThjNzQ1ODRhNjEwNTQ0NWIyYmUxMGEyLnNldENvbnRlbnQoaHRtbF85MDU0ZTlmNmRlY2E0YmUzOWM4Njc2ZjIyMmZhNDBjNik7CiAgICAgICAgICAgIAoKICAgICAgICAgICAgY2lyY2xlX21hcmtlcl8xZWVlYWNhNGJmMTE0NGE1ODRhMGVhNWQ3ODE0OTlkNi5iaW5kUG9wdXAocG9wdXBfMjdiNzY4OWFhOGM3NDU4NGE2MTA1NDQ1YjJiZTEwYTIpOwoKICAgICAgICAgICAgCiAgICAgICAgCiAgICAKICAgICAgICAgICAgdmFyIGNpcmNsZV9tYXJrZXJfYmQ0NDI1YWU3MTY4NGJlNWI4NDMzNWViMTc3YTc4MDggPSBMLmNpcmNsZU1hcmtlcigKICAgICAgICAgICAgICAgIFs0My43MzMyOTIzNDUzLC03OS40OTA0OTczNTE4XSwKICAgICAgICAgICAgICAgIHsKICAiYnViYmxpbmdNb3VzZUV2ZW50cyI6IHRydWUsCiAgImNvbG9yIjogIiNmZmQ3MDAiLAogICJkYXNoQXJyYXkiOiBudWxsLAogICJkYXNoT2Zmc2V0IjogbnVsbCwKICAiZmlsbCI6IHRydWUsCiAgImZpbGxDb2xvciI6ICIjZmZkNzAwIiwKICAiZmlsbE9wYWNpdHkiOiAwLjksCiAgImZpbGxSdWxlIjogImV2ZW5vZGQiLAogICJsaW5lQ2FwIjogInJvdW5kIiwKICAibGluZUpvaW4iOiAicm91bmQiLAogICJvcGFjaXR5IjogMS4wLAogICJyYWRpdXMiOiA1LAogICJzdHJva2UiOiB0cnVlLAogICJ3ZWlnaHQiOiAzCn0KICAgICAgICAgICAgICAgICkuYWRkVG8obWFwX2M2YjFhNDVjOTkxMzRjNTJhYWY4NTVmZDdhNWMzZjNhKTsKICAgICAgICAgICAgCiAgICAKICAgICAgICAgICAgdmFyIHBvcHVwX2NjNGU0YWMyOWJlOTQwNjc5ODM0MzFjMjlkNTFlMDUwID0gTC5wb3B1cCh7bWF4V2lkdGg6ICczMDAnfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIHZhciBodG1sXzIyMWUzMjhlMDVhNTRiZWU4NDczYjUzYmE5NmFjZDU3ID0gJCgnPGRpdiBpZD0iaHRtbF8yMjFlMzI4ZTA1YTU0YmVlODQ3M2I1M2JhOTZhY2Q1NyIgc3R5bGU9IndpZHRoOiAxMDAuMCU7IGhlaWdodDogMTAwLjAlOyI+RG93bnN2aWV3LlJvZGluZy5DRkIgfn5+IENsdXN0ZXI6IDI8L2Rpdj4nKVswXTsKICAgICAgICAgICAgICAgIHBvcHVwX2NjNGU0YWMyOWJlOTQwNjc5ODM0MzFjMjlkNTFlMDUwLnNldENvbnRlbnQoaHRtbF8yMjFlMzI4ZTA1YTU0YmVlODQ3M2I1M2JhOTZhY2Q1Nyk7CiAgICAgICAgICAgIAoKICAgICAgICAgICAgY2lyY2xlX21hcmtlcl9iZDQ0MjVhZTcxNjg0YmU1Yjg0MzM1ZWIxNzdhNzgwOC5iaW5kUG9wdXAocG9wdXBfY2M0ZTRhYzI5YmU5NDA2Nzk4MzQzMWMyOWQ1MWUwNTApOwoKICAgICAgICAgICAgCiAgICAgICAgCiAgICAKICAgICAgICAgICAgdmFyIGNpcmNsZV9tYXJrZXJfMGM5Zjc2ZDAzMWIzNDZkYjhkYjEwMDA5N2NlMmM1ZjIgPSBMLmNpcmNsZU1hcmtlcigKICAgICAgICAgICAgICAgIFs0My42NzEwNDk5OTMxMDAwMDYsLTc5LjI5OTYwMTMwNDNdLAogICAgICAgICAgICAgICAgewogICJidWJibGluZ01vdXNlRXZlbnRzIjogdHJ1ZSwKICAiY29sb3IiOiAiI2ZmZDcwMCIsCiAgImRhc2hBcnJheSI6IG51bGwsCiAgImRhc2hPZmZzZXQiOiBudWxsLAogICJmaWxsIjogdHJ1ZSwKICAiZmlsbENvbG9yIjogIiNmZmQ3MDAiLAogICJmaWxsT3BhY2l0eSI6IDAuOSwKICAiZmlsbFJ1bGUiOiAiZXZlbm9kZCIsCiAgImxpbmVDYXAiOiAicm91bmQiLAogICJsaW5lSm9pbiI6ICJyb3VuZCIsCiAgIm9wYWNpdHkiOiAxLjAsCiAgInJhZGl1cyI6IDUsCiAgInN0cm9rZSI6IHRydWUsCiAgIndlaWdodCI6IDMKfQogICAgICAgICAgICAgICAgKS5hZGRUbyhtYXBfYzZiMWE0NWM5OTEzNGM1MmFhZjg1NWZkN2E1YzNmM2EpOwogICAgICAgICAgICAKICAgIAogICAgICAgICAgICB2YXIgcG9wdXBfMjFiNmQ0YjU3MjBlNGE0OGFmNGNiMDc5MTk4MGNhOTEgPSBMLnBvcHVwKHttYXhXaWR0aDogJzMwMCd9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdmFyIGh0bWxfMTI3ZGYzYWUzNDIzNGFlMGIwMjUyOTJhMDk5ZjE1ZTMgPSAkKCc8ZGl2IGlkPSJodG1sXzEyN2RmM2FlMzQyMzRhZTBiMDI1MjkyYTA5OWYxNWUzIiBzdHlsZT0id2lkdGg6IDEwMC4wJTsgaGVpZ2h0OiAxMDAuMCU7Ij5UaGUuQmVhY2hlcyB+fn4gQ2x1c3RlcjogMjwvZGl2PicpWzBdOwogICAgICAgICAgICAgICAgcG9wdXBfMjFiNmQ0YjU3MjBlNGE0OGFmNGNiMDc5MTk4MGNhOTEuc2V0Q29udGVudChodG1sXzEyN2RmM2FlMzQyMzRhZTBiMDI1MjkyYTA5OWYxNWUzKTsKICAgICAgICAgICAgCgogICAgICAgICAgICBjaXJjbGVfbWFya2VyXzBjOWY3NmQwMzFiMzQ2ZGI4ZGIxMDAwOTdjZTJjNWYyLmJpbmRQb3B1cChwb3B1cF8yMWI2ZDRiNTcyMGU0YTQ4YWY0Y2IwNzkxOTgwY2E5MSk7CgogICAgICAgICAgICAKICAgICAgICAKICAgIAogICAgICAgICAgICB2YXIgY2lyY2xlX21hcmtlcl9jZjEwN2EyY2FhNzg0YWU2OTk5NTM3OWY5NmJkNDc1YyA9IEwuY2lyY2xlTWFya2VyKAogICAgICAgICAgICAgICAgWzQzLjcxNjE4MDQwMzMsLTc5LjU5NjM1NjQ1MzUwMDAxXSwKICAgICAgICAgICAgICAgIHsKICAiYnViYmxpbmdNb3VzZUV2ZW50cyI6IHRydWUsCiAgImNvbG9yIjogIiNmZmQ3MDAiLAogICJkYXNoQXJyYXkiOiBudWxsLAogICJkYXNoT2Zmc2V0IjogbnVsbCwKICAiZmlsbCI6IHRydWUsCiAgImZpbGxDb2xvciI6ICIjZmZkNzAwIiwKICAiZmlsbE9wYWNpdHkiOiAwLjksCiAgImZpbGxSdWxlIjogImV2ZW5vZGQiLAogICJsaW5lQ2FwIjogInJvdW5kIiwKICAibGluZUpvaW4iOiAicm91bmQiLAogICJvcGFjaXR5IjogMS4wLAogICJyYWRpdXMiOiA1LAogICJzdHJva2UiOiB0cnVlLAogICJ3ZWlnaHQiOiAzCn0KICAgICAgICAgICAgICAgICkuYWRkVG8obWFwX2M2YjFhNDVjOTkxMzRjNTJhYWY4NTVmZDdhNWMzZjNhKTsKICAgICAgICAgICAgCiAgICAKICAgICAgICAgICAgdmFyIHBvcHVwXzg1NDRjMWVmYjEzNTQzNjg5Mjc3Y2E4OGMwOWVlYmQ1ID0gTC5wb3B1cCh7bWF4V2lkdGg6ICczMDAnfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIHZhciBodG1sXzg5MjYwODVmODk0OTQ1N2JiZTE1N2VjM2I1N2E5MWViID0gJCgnPGRpdiBpZD0iaHRtbF84OTI2MDg1Zjg5NDk0NTdiYmUxNTdlYzNiNTdhOTFlYiIgc3R5bGU9IndpZHRoOiAxMDAuMCU7IGhlaWdodDogMTAwLjAlOyI+V2VzdC5IdW1iZXIuQ2xhaXJ2aWxsZSB+fn4gQ2x1c3RlcjogMjwvZGl2PicpWzBdOwogICAgICAgICAgICAgICAgcG9wdXBfODU0NGMxZWZiMTM1NDM2ODkyNzdjYTg4YzA5ZWViZDUuc2V0Q29udGVudChodG1sXzg5MjYwODVmODk0OTQ1N2JiZTE1N2VjM2I1N2E5MWViKTsKICAgICAgICAgICAgCgogICAgICAgICAgICBjaXJjbGVfbWFya2VyX2NmMTA3YTJjYWE3ODRhZTY5OTk1Mzc5Zjk2YmQ0NzVjLmJpbmRQb3B1cChwb3B1cF84NTQ0YzFlZmIxMzU0MzY4OTI3N2NhODhjMDllZWJkNSk7CgogICAgICAgICAgICAKICAgICAgICAKPC9zY3JpcHQ+\" style=\"position:absolute;width:100%;height:100%;left:0;top:0;border:none !important;\" allowfullscreen webkitallowfullscreen mozallowfullscreen></iframe></div></div>"
      ],
      "text/plain": [
       "<folium.folium.Map at 0x16458fdfc48>"
      ]
     },
     "execution_count": 243,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# add markers to the map\n",
    "markers_colors = []\n",
    "for lat, lon, poi, cluster in zip(neighbourhood_top20_df['Lat'], neighbourhood_top20_df['Long'], neighbourhood_top20_df['Neighbourhood'], neighbourhood_top20_df['Cluster Labels']):\n",
    "    label = folium.Popup(str(poi) + ' ~~~' + ' Cluster: ' + str(cluster), parse_html=True)\n",
    "    folium.CircleMarker(\n",
    "        [lat, lon],\n",
    "        radius=5,\n",
    "        popup=label,\n",
    "        color=rainbow[cluster-1],\n",
    "        fill=True,\n",
    "        fill_color=rainbow[cluster-1],\n",
    "        fill_opacity=0.9).add_to(map_toronto)\n",
    "       \n",
    "map_toronto"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
